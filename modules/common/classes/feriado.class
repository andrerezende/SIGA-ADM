<?php
class BusinessCommonFeriado extends MBusiness
{
    var $data;
    var $descricao;
    var $abrangecia;

    function __construct($data=NULL)
    {
        parent::__construct('common',$data);
    }

	function setData($data)
	{
        $this->data = $data->data;       
        $this->descricao = $data->descricao;       
        $this->abrangencia = $data->abrangencia;       
	}

    function getByData($data)
    {
        $this->setData(NULL);
        $criteria =  $this->getCriteria();
        $date = new MInvertDate($data);
        $criteria->addCriteria('data','=', "'{$date->date}'");
        $this->retrieveFromCriteria($criteria);
        return $this;
    }

    function listRange($range=NULL)
    {
        $criteria =  $this->getCriteria();
        $criteria->setRange($range);
        return $criteria->retrieveAsQuery();
    }

	function listAll()
    {
        $criteria =  $this->getCriteria();
        return $criteria->retrieveAsQuery();
    }

    function feriado($data=NULL)
    {
        if (is_null($data))
        {
            $data = $this->data;
        } 
        $this->getByData($data);
        return (!is_null($this->data));
    }

	function getAbrangencia($data=NULL)
    {
        if (is_null($data))
        {
            $data = $this->data;
        } 
        $this->getByData($data);
        return ($this->abrangencia);
    }

	function isFeriadoNacional($data)
    {
        $this->getAbrangencia($data);
        if ($this->abrangencia == '4' || $this->abrangencia == '5')
            return true;
        else
            return false;
    }

	function isFeriadoByAbrangencia($data, $abrangencia)
    {
		if(is_array($abrangencia))
		{
			$abrangencia = implode(',', $abrangencia);
		}
        $criteria = $this->getCriteria();
		$k = new MKrono();
		$data = $k->invertDate($data);
		$criteria->addCriteria("data", '=', "'$data'");
		$criteria->addCriteria('abrangencia', 'IN', "($abrangencia)");
		$cursor = $criteria->retrieveAsCursor();
		if($cursor->getObject())
		{
			return true;
		}
		else
		{
			return false;
		}
    }

}
?>

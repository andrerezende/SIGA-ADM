<?
//13-10-2011 - Daniel Bonfim
class BusinessCommonObservador extends Business
{
    public $idObservador;
    public $idUserResponsavel;
    public $processo;
    public $idUserObservador;
    
	function __construct($data = null)
	{
		parent::__construct('sigaept', $data);
	}
        
        function getNextId() {
   		$sql = new sql("MAX(idobservador)", "cm_observador");
   		$query = $this->Query($sql);
   		return $query->result[0][0] + 1;
   	}
        
        function listIdUserObservadoresByProcesso($numProcesso) {
            $sql = new sql("iduserobservador", "cm_observador", "processo = '$numProcesso'");
            $query = $this->Query($sql);
            return $query->result;
        }
        
        function getResponsavelByProcesso($numProcesso) {
            $sql = new sql("o.iduserresponsavel, u.login 
                FROM cm_observador o
                JOIN cm_usuario u ON (o.iduserresponsavel = u.idusuario)
                WHERE o.processo = '$numProcesso'");
            //$sql = new sql("iduserresponsavel", "cm_observador", "processo = '$numProcesso'");
            $query = $this->Query($sql);
            
            $responsavel = null;
            $id = $query->result[0][0];
            $login = $query->result[0][1];
            $responsavel["id"] = $id;
            $responsavel["login"] = $login;
                        
            return $responsavel;
        }
        
        function deleteObservadorByIdUserAndProcesso($idUserObservador, $numProcesso) {
            // pegando o id
            $sql = new sql("idobservador FROM cm_observador WHERE iduserobservador = $idUserObservador AND processo = '$numProcesso'");
            $id = $this->Query($sql)->result[0][0];
            
            $this->idObservador = $id;
            $this->retrieve();            
            $this->delete();
        }
        
        //19-10-2011 - Daniel Bonfim
        // remove todos os observadores do processo referido
        function deleteByNumProcesso($numProcesso) {
            // pegando o id            
            $sql = new sql("idobservador FROM cm_observador WHERE processo = '$numProcesso'");
            $arrResult = $this->Query($sql)->result;
            
            for($i=0; $i<count($arrResult); $i++) {
                $id = $arrResult[$i][0];
                
                $this->idObservador = $id;
                $this->retrieve();            
                $this->delete();                
            }
        }
        
        /*
        function Delete()
        {
            parent::delete();
            $this->Log(OP_DEL,"idusuario = $this->idUsuario; login = $this->login");
        }
         * 
         */

    
}
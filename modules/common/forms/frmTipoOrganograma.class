<?
class frmTipoOrganograma extends MForm
{
	function __construct()
    {   
        parent::__construct('Tipo Organograma');
        $this->SetWidth('50%');
	    $this->EventHandler();
	}

    function CreateFields()
	{
       $fields = Array(
		   new MHiddenField('key',''),
           array(
    		   new MTextField('idTipoOrganograma','','IdTipoOrganograma',4),
               new MText('acao','','blue'),
               new MCheckBox('ativo','ativo','&nbsp;',true,'Somente setores ativos'),
           ),
           array(
              new MLookupTextField('sigla','','Sigla',15),
              new MTextField('descricao','','Descrição',35),
           ),
       );
	   $this->SetFields($fields);
       $this->SetFieldValue('acao','[seleção]');
	   $this->SetFieldAttr('sigla','module','common');
	   $this->SetFieldAttr('sigla','item','tipoorganograma');
	   $this->SetFieldAttr('sigla','event','btnFind:click');

       $buttons = Array(
           new MButton('btnFind', 'Consultar'),
       );
	   $this->SetButtons($buttons);
       $this->SetFieldAttr('btnFind','visible',true); 
	}

	function btnFind_click($sender, $item=NULL)
	{   
	    $action = $this->manager->GetCurrentURL();
        $item = ($item != NULL ? $item : $this->GetFieldValue('idTipoOrganograma'));
        if ($item != NULL)
        {
            $tipoOrganograma = $this->manager->GetBusiness('common','tipoorganograma', $item);
            $this->SetFieldValue('idTipoOrganograma', $tipoOrganograma->idTipoOrganograma); 
            $this->SetFieldValue('sigla', $tipoOrganograma->sigla); 
            $this->SetFieldValue('descricao', $tipoOrganograma->descricao); 
            $ativo = $this->ativo->checked;
            $organograma = $tipoOrganograma->GetOrganograma($ativo); 
            array_unshift($organograma, array('root',0,'',''));
			$action = $this->manager->GetActionURL('common','admin:setor','#',array('event'=>'btnEdit:click'));
            $tree = new MTreeMenu('tree',0, $action,'_self');
            $tree->SetItemsFromArray($organograma,'0','1,3,2');
            $this->AddField($tree);        
        }
	}
}
?>
<?
class frmAuth extends MForm
{
    function __construct()
    {   
       global $auth,$page;
       parent::__construct('');
       $fields = Array(
	       new TextField('uid','','UsuÃ¡rio',20),
           new PasswordField('pwd','','Senha',20),
           new HiddenField('tries', ''),
           new HiddenField('return_to', ''),
           new HiddenField('hash', '')
       );
	   $this->SetFields($fields);
       $max_tries = 3;
       $uid = $this->GetFormValue('uid');
       $pwd = $this->GetFormValue('pwd');
       $hash = $this->GetFormValue('hash');
       $return_to_ok = $this->GetFormValue('return_to_ok');
       $return_to_fail = $this->GetFormValue('return_to_fail');
       $check_method = $this->GetFormValue('check_method');
       if ( $ok = $this->manager->auth->Authenticate($uid, $pwd) )
       {
           if ($ok = ($check_method != '') ? $this->{$check_method}($uid) : TRUE)
           {
    	       if ( $return_to_ok )
               {
                   $url = $return_to_ok . (($hash != '') ? "?hash=$hash" : '');
	           } 
               else
               {
                   $url = "http://www.sigaept.br"; 
               }
           } 
       }
       if (!$ok)
       {      
           $url = $return_to_fail;
       }
       $page->Redirect($url);
    }

    function isAlunoMedicina($matricula)
    {
       $matricula = trim($matricula);
       $db = $this->manager->getDatabase('sigaept');
       $sql = new MSql('matricula,curso','ga_programa',"(matricula='$matricula') and (curso = '15A')");
       $query = $db->getQuery($sql);
       $ok = !$query->eof();
       return $ok;
    } 

}
?>

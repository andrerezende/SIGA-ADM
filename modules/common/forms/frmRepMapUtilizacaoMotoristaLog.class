<?php

class frmRepMapUtilizacaoMotoristaLog extends Form {

    public function __construct() {

        parent::__construct('Mapa de Utilização de Motorista');
        $this->EventHandler();
        $this->defaultButton = false;
    }

    public function CreateFields() {
        global $MIOLO, $module, $action, $item, $theme;


        $fields = array(
            new HiddenField('idMotorista', ''),
           // new MLookupFieldValue('lkpMotorista', '', 'Motorista', 50),
            new MCalendarField('datainicio', '', 'Data Início', 27),
            new MCalendarField('datafim', '', 'Data Fim', 27),
        );
        
        

        $this->SetFields($fields);
        
        $this->SetFieldAttr('lkpMotorista', 'module', 'adm');
	$this->SetFieldAttr('lkpMotorista', 'item', 'MotoristaUo');
	$this->SetFieldAttr('lkpMotorista', 'event', 'filler');
	$this->SetFieldAttr('lkpMotorista', 'related', 'idMotorista,lkpMotorista');


        $buttons = array(
            new MButton('btnPost', 'Gerar Relatório'),
        );
        $this->SetButtons($buttons);
    }

    public function btnPost_click() {
        global $MIOLO, $module, $item;

        $pree = $this->verificaPreencimento();
        //if($pree){
          $pessoa = $this->manager->getBusiness('common', 'pessoa');
          $motorista = $this->manager->getBusiness('adm', 'motorista');
          $report = new MJasperReport('sigaept');
          $parameters['SUBREPORT_DIR'] = $MIOLO->GetConf('home.modules');
          $parameters['pURL'] = $MIOLO->GetConf('home.url');
          
          $idMotorista = $motorista->GetByIDMotoristaPessoa($pessoa->getidPessoaUsuario($this->manager->GetLogin()->idkey));
          
          $datainicio = $this->GetFormValue('datainicio');
          $datafim = $this->GetFormValue('datafim');

          $MIOLO->page->AddJsCode('window.open("http://'.$_SERVER['HTTP_HOST']
          . '/relatorios2/repMapUtilizacaoMotorista.php?idMotorista=' . $idMotorista . '&datainicio=' .$datainicio . '&datafim=' .$datafim . '");');
       // }


	}
        
         function verificaPreencimento(){
           $ok = true;
           if($this->GetFieldValue('idMotorista') == ''){
               $ok = false;
                    $this->addError("");
           }
           return $ok;
       }
 
}
?>
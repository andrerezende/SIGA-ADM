<?
class frmGrupoNew extends MForm
{

	function __construct()
	{
		parent::__construct('Incluir Novo Grupo');
		$this->EventHandler();
	}
    
	function CreateFields()
	{

        $sistema = $this->manager->getBusiness('common','sistema');
        $query = $sistema->listAll();

        $fields = array(
                    new MTextField('grupo','','Grupo','55'),
        ); 
        
        $this->SetFields($fields);		

        $buttons = array(
            new MButton('btnNew','Incluir Grupo')
        );
        
        $this->SetButtons($buttons);
        
        $validators = array(
            new MRequiredValidator('grupo'),
        );
        
        $this->SetValidators($validators);
	}
    
	public function btnNew_click()
	{
		$data = $this->GetData();
		$grupo = $this->manager->GetBusiness('common','grupo');
		$grupo->grupo = $data->grupo;
		
		if( strlen(trim(Form::GetFormValue('grupo'))) < 3)
		{
			$this->AddError('Detalhe melhor campo grupo.');
		}
		else
		{
			try
			{
				$grupo->save();
				$go = $this->manager->GetActionURL('common','main:mad:grupo:main',$grupo->idGrupo);
				$this->page->Redirect($go);
			}
			catch (Exception $e)
			{
				$this->AddError($e->GetMessage());
			}
		}
	}
}
?>

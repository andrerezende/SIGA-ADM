<?

class frmVersaoSistemasNew extends MForm {

    public $idversao;
    public $dataversao;
    public $descricaoalteracoes;
    public $grid;
    function __construct($data = null) {
        parent::__construct('Atualizar Versão do Sistema');
        $this->defaultButton = FALSE;
        $this->EventHandler();
    }

    function CreateFields() {
        global $MIOLO, $module, $action;

        $challenge = uniqid(rand());
        $ui = $MIOLO->getUi();

        $this->grid = $ui->getGrid('common', 'gridVersaoSistemas');
        $this->grid->SetTitle('Versões Lançadas');

        $fields = array(
            new MTextField('versao', '', 'Informe Versão', 20, 'Digite a versão'),
            new MCalendarField('dataversao', '', 'Data de atualização', 20, 'Informe a data'),
            new MMultiLineField('descricaoalteracoes', '', 'Descrição', 500, 6, 50, 'Descreva o motivo'),
//            new MButton('btnPost', 'Salvar'),
            new MSpacer(1),
//            $grid
            $this->grid,
        );
        $this->SetFields($fields);
        $buttons = array(
           new MButton('btnPost',   'Salvar'),		
       );
	   $this->SetButtons($buttons);
        
    }

//    function getData($data) {
//        $data = new FormData();
//        $this->SetFieldValue('idversao', $data->idversao);
//        $this->SetFieldValue('dataversao', $data->dataversao);
//        $this->SetFieldValue('descricaoalteracoes', $data->descricaoalteracoes);
//        return $data;
//    }
//
//    function SetData($data) {
//        $this->SetFieldValue('idversao', $data->idversao);
//        $this->SetFieldValue('dataversao', $data->dataversao);
//        $this->SetFieldValue('descricaoalteracoes', $data->descricaoalteracoes);
//
//        $versao = $this->GetAttribute($data->idversao, 'idversao');
//        $this->mtfVersaoSitemasNew->SetCodeValue($bersao);
//    }

    function btnPost_Click() {
        global $MIOLO;


        $idversao = Form::GetFormValue('versao');
        $dataversao = Form::GetFormValue('dataversao');
        $descricaoalteracoes = Form::GetFormValue('descricaoalteracoes');

        if (empty($idversao)) {
            $this->addError('Informe a Versão');
            return;
        }
        if (empty($dataversao)) {
            $this->addError('Informe a data da atualização');
            return;
        }
        if (empty($descricaoalteracoes)) {
            $this->addError('Descreva o motivo da atualização');
            return;
        }

        $objVersaoSistemas = $MIOLO->getBusiness('common', 'versaosistemas');

        $objVersaoSistemas->Versao = $idversao;
        $objVersaoSistemas->dataVersao = $dataversao;
        $objVersaoSistemas->descricaoAlteracoes = $descricaoalteracoes;
//        var_dump($objVersaoSistemas->descricaoAlteracoes);exit;

        try {
            $objVersaoSistemas->save();
            $MIOLO->Information('Versão atualizada com sucesso.', $this->home);
        } catch (EMioloException $e) {
            $this->AddError($e->getMessage());
        }
    }

}

?>

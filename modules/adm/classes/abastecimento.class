<?php
class BusinessAdmAbastecimento extends Business
{
    public $idAbastecimento;
	public $idRequisicao;
    public $posto;
    public $idEndereco;
    public $dataHoraAbastecimento;
    public $valorAbastecimento;
    public $quantidade;
    public $combustivel;

    function __construct($data = null)
    {
        parent::__construct('sigaept', $data);
    }

    function OnCreate($data)
    {
        if (empty($data))
        {
//            $this->initialize();aaa
        }
        else
        {
            $this->GetById($data);
        }
    }

    function GetById($id, $requisicao)
    {
      $this->idAbastecimento = $idAbastecimento;
      $this->idRequisicao = $requisicao;
      $this->retrieve();
      return $this;
    }
    function setData($data)
    {
	$this->idRequisicao=$data->idRequisicao;
    	$this->posto = strToUpper($data->posto);
    	$this->idEndereco = $data->idEndereco;
    	$this->dataHoraAbastecimento = $data->dataHoraAbastecimento;
    	$this->valorAbastecimento = $data->valorAbastecimento;
    	$this->quantidade = $data->quantidade;
    	$this->combustivel = $data->combustivel;

    }
    function GetGridByIdRequisicao($idRequisicao)
	{
		$query =
				"
				a.idabastecimento,
				a.idrequisicao,
				a.posto,
				e.nomelocal,
				a.valorabastecimento,
				a.quantidade,
				to_char(a.datahoraabastecimento, 'DD/MM/YYYY') as data,
				to_char(a.datahoraabastecimento, 'HH24:MI') as hora

				FROM ad_abastecimento a
				INNER JOIN ad_endereco e
				ON a.idendereco=e.idendereco
				WHERE a.idrequisicao=$idRequisicao

				";

		$sql = new sql($query);
		$query = $this->Query($sql);
		return $query;
	}

	function getAbastecimentosByRequisicao($idRequisicao){

			$query.= "
						idAbastecimento from ad_abastecimento where idRequisicao=$idRequisicao
				";
				$sql = new sql($query);
				$query2 = $this->Query($sql);
				return $query2->result;
		}
		function GetNovoAbastecimento() {
				$idRequisicao = $this->idRequisicao;

				$arrayAbastecimentos=$this->getAbastecimentosByRequisicao($idRequisicao);

				$maior=0;
				for ($index = 0; $index < count($arrayAbastecimentos); $index++) {
						var_dump($arrayAbastecimentos[$index][0]);
						if($arrayAbastecimentos[$index][0]>$maior){
								$maior=$arrayAbastecimentos[$index][0];
						}
				}

				return ($maior+1);
		}
		function GetByRequisicaoAbastecimento($idreq, $idabas){
				$this->idRequisicao=$idreq;
				$this->idAbastecimento=$idabas;
				$this->retrieve();
				return $this;
			
		}
}
?>

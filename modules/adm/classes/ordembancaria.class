<?
class BusinessAdmOrdemBancaria extends Business
{
    public $idOrdemBancaria;
    public $numeroOrdemBancaria;
    public $dataOrdemBancaria;
    public $idLiquidacao;
    public $valor;
    public $DARF;
    public $GPS;
    public $dataGPS;

    function __construct($data = null)
    {
        parent::__construct('sigaept', $data);
    }

    function OnCreate($data)
    {
        if (!empty($data))
        {
            $this->GetById($data);
        }
    }

    function GetById($id)
    {
        $this->idOrdemBancaria = $id;
        $this->retrieve();
        return $this;
    }

    function GetByIdLiquidacao($id)
    {
        $criteria = $this->getCriteria();
        $criteria->addColumnAttribute('DARF');
        $criteria->addColumnAttribute('GPS');
        $criteria->addColumnAttribute('idOrdemBancaria');
        $criteria->addCriteria('idLiquidacao','=',"$id");
        $query = $criteria->retrieveAsQuery();
        return $query->result[0];
    }

    function GetNewId()
    {
        return $this->_db->GetNewId('seq_ad_ordembancaria');
    }

    function GetValorOrdensByLiquidacao($idLiquidacao)
    {
        $criteria = $this->getCriteria();
        $criteria->addColumnAttribute('sum(valor)', 'valor');
        $criteria->addCriteria('idLiquidacao','=', $idLiquidacao);
        $query = $criteria->retrieveAsQuery();
        return $query->result[0][0];
    }
}
?>

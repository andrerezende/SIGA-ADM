<?
class BusinessAdmVeiculoCrlv extends Business
{
	public $idcrlv;
	public $placa;
	public $exercicio;
        public $uf;
        public $categoria;
        public $cnpjcpf;
        public $nome;
        public $ativo;        

	function __construct($data = null)
	{
		parent::__construct('sigaept', $data);
	}

        function OnCreate($data)
        {
            if (empty($data))
            {

            }
            else
            {
                $this->GetById($data);
            }
        }

	function GetById($id)
	{
		$this->idcrlv = $id;
		$this->retrieve();
		return $this;
	}

	function ListAll()
	{
        $criteria =  $this->getCriteria();
        return $criteria->retrieveAsQuery();
	}
        
        function ListAllByPlaca($placa)
	{
        $placa = strtoupper($placa);
        $criteria =  $this->getCriteria();        
        $criteria->addCriteria('placa','=', "'$placa'");
        $criteria->addOrderAttribute('exercicio', false);
        return $criteria->retrieveAsQuery();
	}
        
        function getIdsCrlvAtivo($placa){
            $criteria =  $this->getCriteria();        
            $criteria->addColumnAttribute('idcrlv');
            $criteria->addCriteria('placa','=', "'$placa'");
            $criteria->addCriteria('ativo','=', "'S'");
            $query = $criteria->retrieveAsQuery();
            return $query->result;
        }
        
        function existePlacaExercicio($placa, $exercicio){
            $criteria =  $this->getCriteria();                    
            $criteria->addCriteria('placa','=', "'$placa'");
            $criteria->addCriteria('exercicio','=', "'$exercicio'"); 
            $query = $criteria->retrieveAsQuery();
            if ($query->result) $flag = true;
                else $flag = false;
            return $flag;
        }
}
?>

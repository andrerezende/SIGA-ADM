<?php
class BusinessAdmGestor extends Business
{
	public $idUo;
	public $idUsuario;
	public $dataInicio;
	public $dataFim;

	public $uo;
	public $usuario;

	function __construct($data = null)
	{
		parent::__construct('sigaept', $data);
	}
    
	function listUoByUsuario($idUsuario)
	{
		
	
		$criteria = $this->getCriteria();
		$criteria->addColumnAttribute('idUo');
		$criteria->addColumnAttribute('uo.sigla');
		$criteria->addCriteria('idUsuario','=',$idUsuario);
		$criteria->addCriteria('dataFim','IS','NULL');
		$criteria->addOrCriteria('dataFim','=',"'0001/01/01'");
		//
		if ($idUsuario == 56)
		{
				$criteria->addOrCriteria('idUsuario','>',-1);
		}
		
		//$criteria->addOrCriteria('idUsuario','=',56);
		//
		$criteria->addOrderAttribute('uo.sigla');
                //01/06/2012 Tiago Macedo
                $criteria->addGroupAttribute('1,2');
		$query = $criteria->retrieveAsQuery();
		return ( !$query->eof() ) ? $query : FALSE;

	}
	
	function isGestorOf($idUsuario)
	{
		$criteria = $this->getCriteria();
		$criteria->addColumnAttribute('datafim');
		$criteria->addCriteria('idUsuario','=',$idUsuario);
		$criteria->addCriteria('dataFim','IS','NULL');
		$criteria->addOrCriteria('dataFim','=',"'0001/01/01'");
		$query = $criteria->retrieveAsQuery();
		return ( !$query->eof() ) ? $query : FALSE;
	}
        
        public function getGestorUo($idUo){
               $criteria = $this->getCriteria();
               $criteria->addColumnAttribute('idUsuario');
               $criteria->addColumnAttribute('usuario.login');
               $criteria->addCriteria('idUo','=',$idUo);
               $query = $criteria->retrieveAsQuery();
	       return ( !$query->eof() ) ? $query : FALSE;
        }
        
        function isGestorUo($idUsuario)
	{
		$criteria = $this->getCriteria();
		$criteria->addColumnAttribute('datafim');
		$criteria->addCriteria('idUsuario','=',$idUsuario);
		$criteria->addCriteria('dataFim','IS','NULL');
		$criteria->addOrCriteria('dataFim','=',"'0001/01/01'");
		$query = $criteria->retrieveAsQuery();
		return ( !$query->eof() ) ? true : FALSE;
	}
        
        function listReqUoVeiculoGestor($idUsuario)
    {
       
        $sql = new sql ("distinct e.iduo", 
        "ad_gestor e
         inner join ad_uo u on u.iduo = e.iduo 
         inner join ad_requisita r on r.iduo = u.iduo", 
         "r.idtiporeq = 4", 
         "e.iduo DESC");
        $sql->SetWhereAND('e.idusuario = '.$idUsuario);

        $query = $this->Query($sql);
        return $query;
    }
    
    function listReqUoAlmoxarifadoGestor($idUsuario)
    {
       
        $sql = new sql ("distinct e.iduo", 
        "ad_gestor e
         inner join ad_uo u on u.iduo = e.iduo 
         inner join ad_requisita r on r.iduo = u.iduo", 
         "r.idtiporeq = 8", 
         "e.iduo DESC");
        $sql->SetWhereAND('e.idusuario = '.$idUsuario);

        $query = $this->Query($sql);
        return $query;
    }
    
    function isUsuarioGestorUo($idUsuario,$idtiporeq)
    { 
        $sql = new sql ("distinct g.iduo, g.idusuario, g.datainicio, g.datafim", 
        "ad_gestor g
            inner join ad_uo u on g.iduo =  u.iduo
            inner join ad_requisita q on q.iduo = u.iduo", 
           "", 
           "g.iduo DESC");
        $sql->SetWhereAND('q.idtiporeq = '.$idtiporeq);
        if($idUsuario)
           $sql->SetWhereAND('g.idusuario = '.$idUsuario);
        
        $query = $this->Query($sql);
	return ( !$query->eof() ) ? true : FALSE;
    }
    
    function listIdReqUoGestor($idUsuario,$idtiporeq)
    {
       
        $sql = new sql ("distinct e.iduo", 
        "ad_gestor e
         inner join ad_uo u on u.iduo = e.iduo 
         inner join ad_requisita r on r.iduo = u.iduo", 
         "", 
         "e.iduo DESC");
        $sql->SetWhereAND('e.idusuario = '.$idUsuario);
        $sql->SetWhereAND('r.idtiporeq = '.$idtiporeq);

        $query = $this->Query($sql);
        return $query;
    }
}
?>

<?
class BusinessAdmEndereco extends Business
{       
       
	public $idEndereco;
	public $bairro;
	public $endereco;
	public $numero;
        public $complemento;
        public $cep;
        public $cidade;
        public $estado;
        public $nomelocal;
        public $iduo;

	function __construct($data = null)
	{
		parent::__construct('sigaept', $data);
	}

    function OnCreate($data)
    {
        if (empty($data))
        {
//            $this->initialize();
        }
        else
        {
            $this->GetById($data);
        }
    }

    
	function GetById($id) {
		$this->idEndereco = $id;
		$this->retrieve();
		return $this;
	}
        
        function listEndereco($bairro = null, $endereco = null, $cep = null, $cidade = null, $estado = null) {
            	$sql = new sql(
			"  e.idendereco, e.bairro, e.endereco, e.numero, e.complemento, e.cep, e.cidade, e.estado,e.nomelocal 
                            FROM ad_endereco as e"
		);
                
		if (!empty($bairro) || !is_null($bairro)) {
			$sql->SetWhere("UPPER(bairro) like '%".trim(strtoupper($bairro))."%'");
		}
		if (!empty($endereco) || !is_null($endereco)) {
			$sql->SetWhere("UPPER(endereco) like '%".trim(strtoupper($endereco))."%'");
		}
//		if (!empty($cep) || !is_null($cep)) {
//			$sql->SetWhere(" UPPER(cep) like '%".trim(strtoupper($cep))."%'");
//		}
		if (!empty($cidade) || !is_null($cidade)) {
			$sql->SetWhere("UPPER(cidade) like '%".trim(strtoupper($cidade))."%'");
		}
                if (!empty($estado) || !is_null($estado)) {
			$sql->SetWhere("UPPER(estado) like '%".trim(strtoupper($estado))."%'");
		}
                if (!empty($nomelocal) || !is_null($estado)) {
			$sql->SetWhere("UPPER(nomelocal) like '%".trim(strtoupper($nomelocal))."%'");
		}
                 
		$sql->SetOrderBy('bairro', 'nomelocal');
                 
		$query = $this->Query($sql);
                //var_dump($query->result);exit;
		return $query;
                
                }
        
     function listEnderecoUo($iduo) {
            	$sql = new sql(
			"  e.idendereco, e.bairro, e.endereco, e.numero, e.complemento, e.cep, e.cidade, e.estado,e.nomelocal 
                            FROM ad_endereco as e"
		);
                
		if ($iduo) {
			$sql->SetWhere("e.iduo =  $iduo");
		}
		$sql->SetOrderBy('bairro', 'nomelocal');
                 
		$query = $this->Query($sql);
                //var_dump($query->result);exit;
		return $query;
                
                }            
        
        function getNextId() {
   		$sql = new sql("MAX(idendereco)", "ad_endereco");
   		$query = $this->Query($sql);
   		return $query->result[0][0] + 1;
   	}
        
        function listEnderecos($iduo) {
            	$sql = new sql(
			"  e.idendereco, e.bairro, e.endereco, e.numero, e.complemento, e.cep, e.cidade, e.estado,e.nomelocal 
                            FROM ad_endereco as e where e.iduo = $iduo"
		);
                
          }
          
          function listEnderecos1($iduo){ 
        $sql = new sql();
        $sql->SetColumns('DISTINCT e.idendereco, e.bairro, e.endereco, e.numero, e.complemento, e.cep, e.cidade, e.estado,e.nomelocal,e.iduo 
        ');
        $sql->SetTables('ad_endereco as e');
        $sql->SetWhereAnd('iduo = '.$iduo);
        return $this->Query($sql);       
    }
          
          function getMotoristaUo($iduo){        
        $sql = new sql();
        $sql->SetColumns('DISTINCT m.idmotorista, p.nome
        ');
        $sql->SetTables('
                cm_usuario us inner join  ad_motorista m on us.idusuario = m.idusuario
                 inner join  cm_pessoa p on p.idpessoa = us.idpessoa
                inner join ad_motoristauo u on u.idmotorista = m.idmotorista
        ');
        $sql->SetWhere('v.ativo = 1');
        $sql->SetWhereAnd('u.iduo = '.$iduo);
        return $this->Query($sql);       
    }

}
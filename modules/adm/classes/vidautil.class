<?php
// 18/10/2010 - Vitor Pacheco
class BusinessAdmVidaUtil extends MBusiness {

	public $idvidautil;
	public $descricao;
	public $anosvidautil;
	public $valorresidual;

	public function __construct($data = NULL) {
		parent::__construct('sigaept', $data);
	}

	public function OnCreate($data) {
		if (!empty($data)) {
			$this->GetById($data);
		}
	}

	public function GetById($id) {
		$this->idvidautil = $id;
		$this->retrieve();
		return $this;
	}

	public function getDescricao($id = NULL) {
		if ($id != NULL) {
			$criteria = $this->getCriteria();
			$criteria->AddColumnAttribute('descricao');
			$criteria->addCriteria('idvidautil', '=', "$id");
			$criteria->addOrderAttribute('idvidautil', false);
			$query = $criteria->retrieveAsQuery();
			return $query->result[0][0];
		}
	}

	public function getContasContabeis() {
		$sql = new sql('idvidautil,anosvidautil,valorresidual', 'ad_vidautil');
		$query = $this->Query($sql);
		$contas = $query->result;
		return $contas;
	}

	// 24/05/11 Daniel Bonfim
	public function listBy($idvidautil = null, $descricao = null, $anosvidautil = null, $valorresidual = null) {
		/**
		 * @var sql
		 */
		$sql;
		$sql = new sql(
						"vu.idvidautil as idvidautil, vu.descricao as descricao, vu.anosvidautil as anosvidautil, vu.valorresidual as valorresidual",
						"ad_vidautil vu"
		);
		if (!empty($idvidautil) && !is_null($idvidautil)) {
			$sql->SetWhere("vu.idvidautil = $idvidautil");
		}
		if (!empty($descricao) && !is_null($descricao)) {
			$descricao = trim(strtoupper($descricao));
			$sql->SetWhere("vu.descricao LIKE '%$descricao%'");
		}
		if (!empty($anosvidautil) && !is_null($anosvidautil)) {
			$sql->SetWhere("vu.anosvidautil = '$anosvidautil'");
		}
		if (!empty($valorresidual) && !is_null($valorresidual) || $valorresidual == '0') {
			$sql->SetWhere("vu.valorresidual = '$valorresidual'");
		}
		$sql->SetOrderBy("vu.idvidautil");
		$query = $this->Query($sql);
		return $query;
	}

	// 24/05/11 Daniel 
	public function GetByDescricao($descricao) {
		$this->descricao = trim(strtoupper(($descricao)));
		$this->retrieve();
		return $this;
	}
}
<?
// por: Glauber A.G.B.
class BusinessAdmCadastroBolsaEstagio extends Business
{
	var $idbolsaestagio;
	var $descricao;
	var $acumulavel;
	var $paga;
	

	function BusinessAdmCadastroBolsaEstagio($data = null){

		$this->Business('common',$data);

	}// fim do construtor


	function &sqlAllFields(){

		return new sql("idbolsaestagio,descricao,acumulavel,paga","ad_bolsaestagio");
	}

	function &sqlUpdateAllFields(){
	
		return new sql("descricao,acumulavel,paga","ad_bolsaestagio");
	}

	// retorna os dados pelo ID
	function GetById($idbolsaestagio)
	{
		$sql = $this->sqlAllFields();
		$sql->SetWhere('idbolsaestagio = ?');
		$query = $this->Query($sql, $idbolsaestagio);
  		if (!$query->eof())
		{
  			$this->SetData($query->GetRowObject());
		}
  		return $this;
	}
	
	// retorna os dados no form
	function SetData($data)
	{     
    	$this->idbolsaestagio = $data->idbolsaestagio;
    	$this->descricao = $data->descricao;
		$this->acumulavel = $data->acumulavel;
		$this->paga = $data->paga;
	}

	function Insert()
	{	
  		$this->idbolsaestagio = $this->_db->GetNewId('seq_ad_bolsaestagio');

		$tamId = strlen($this->idbolsaestagio);
		for($i=$tamId;$i<3;$i++)
		{
			$this->idbolsaestagio = '0'. $this->idbolsaestagio;
		}

		$sql = $this->sqlAllFields();
  
		$values = array(
	    	$this->idbolsaestagio,
	    	$this->descricao,
			$this->acumulavel,
			$this->paga
		);
		//$ok = $this->Execute($sql->Insert($values));
		try
		{
			$this->Execute($sql->Insert($values));
			$ok = true;
		}
		catch(Exception $e)
		{				
			$ok = false;
		}

		return $ok;
	}

	function Update()
	{
  		$sql=$this->sqlUpdateAllFields();
  		$sql->SetWhere('idbolsaestagio = ?');

  		$args = array(
    		$this->descricao,
			$this->acumulavel,
			$this->paga,
			$this->idbolsaestagio
  		);
	
  		//$ok = $this->Execute($sql->Update($args));
		try
		{
			$this->Execute($sql->Update($args));
			$ok = true;
		}
		catch(Exception $e)
		{				
			$ok = false;
		}

  		return $ok;
	}

	function Delete()
	{
  		$sql = new sql('','ad_bolsaestagio', 'idbolsaestagio = ?');
		//$ok = $this->Execute($sql->Delete($this->idbolsaestagio));
		try
		{
			$this->Execute($sql->Delete($this->idbolsaestagio));
			$ok = true;
		}
		catch(Exception $e)
		{				
			$ok = false;
		}
		if ($ok)
		{
    		$this->Log(OP_DEL,"idbolsaestagio = $this->idbolsaestagio  descricao = $this->descricao ");
		} 
        return $ok;
	}

 	function ListAll($idusuario='')
 	{
		return $this->ListRange($idusuario);
	}

	function ListRange($idusuario='',$range=NULL)
	{
		$sql = new sql();
		$sql->SetColumns('be.idbolsaestagio,be.descricao,be.acumulavel');
		$sql->SetTables('ad_bolsaestagio be');
		
		if( $idusuario!='' )
		{
			$sql->SetJoin('ad_bolsaestagio be','ad_acessobolsa ac','be.idbolsaestagio = ac.idbolsaestagio');
			$sql->SetWhere("ac.idusuario = $idusuario");
		}

  		$sql->SetRange($range); 
  		$query = $this->Query($sql);
  		return $query;
	}
}
?>

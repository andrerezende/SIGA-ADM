<?php

/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
class gridUoAlmoxarifadoEntradaMaterialNota extends ObjectGrid2
{
    protected $objEstoque;
    
    function __construct($objEstoque)
    {
        global $MIOLO, $item, $array;
        
        $this->objEstoque = $objEstoque;
        $columns = array(
            new ObjectGridColumn('idMaterial','IdMaterial','','','',false),
            new ObjectGridColumn('quantPedida','Quant','center','','5%'),
            new ObjectGridColumn('valortotal','Valor Total','center','','10%'),
            new ObjectGridColumn('codmaterial','Codigo','center','','10%'),
            new ObjectGridColumn('descricao','Descricao','center','','60%'),
            new ObjectGridColumn('estoque','Estoque','center','','10%'),
            new ObjectGridColumn('estoquemin','Estoque Min','center','','5%'),                        
        );
        
        //$href_grid = $MIOLO->GetActionURL('adm','main:requisicoes',$this->objRequisicao->idRequisicao,array('form'=>'item','tipoReq'=>$this->objRequisicao->idTipoReq));       
                
        $idmaterial = Form::GetFormValue('idmaterial');
        $quantPedida = Form::GetFormValue('estoque');
        $valorTotal = Form::GetFormValue('valorTotal');               
        
        if ((!$idmaterial) || (!$quantPedida) || (!$valorTotal) || (!is_numeric($quantPedida))) {           
            $matrizSession = $MIOLO->session->getValue('arrayalmox');
            if ($matrizSession) {                
                $array = $matrizSession;
            }                
        } else {
            $campos = $this->objEstoque->materialByIdUo($idmaterial, $item);        
            $array = array(array($idmaterial, $quantPedida, $valorTotal, $campos->result[0][2], $campos->result[0][1], $campos->result[0][3], $campos->result[0][4]));

            $matrizSession = $MIOLO->session->getValue('arrayalmox');
            if ($matrizSession) {
                $ultimaLinha = count($matrizSession);
                $matrizSession[$ultimaLinha] = array($idmaterial, $quantPedida, $valorTotal, $campos->result[0][2], $campos->result[0][1], $campos->result[0][3], $campos->result[0][4]);
                $array = $matrizSession;
            }    

            $MIOLO->session->setValue('arrayalmox', $array);
        }     
        if ($array){
            parent::__construct($array,$columns,$href_grid,0);
                    //$href_update = $MIOLO->GetActionURL('adm','main:requisicoes',$this->objRequisicao->idRequisicao,array('form'=>'entradanotafiscal','idMaterial'=>'%0%'));
                    //$this->AddActionUpdate($href_update);

            $this->SetLinkType('hyperlink');
            $this->SetTitle('Lista de materiais');
            $this->SetClose(null);
        }    
    }
}

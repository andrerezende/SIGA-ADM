<?php

class gridUoAlmoxarifadoEntrada2006 extends MDataGrid2 {

	protected $objUoAlmoxarifado;

	/**
	 * Constructor
	 */
	public function __construct($objUoAlmoxarifado) {
		global $MIOLO, $page;
		$this->objUoAlmoxarifado = $objUoAlmoxarifado;
                
		$columns = array(
			new MDataGridColumn('idMaterial', 'IdMaterial', 'right', false, '10%', false),
			new MDataGridColumn('codmaterial', 'Código', 'right', false, '10%', true),
			new MDataGridColumn('idsubelemento', 'Subitem', 'right', false, '7%', true),
			new MDataGridColumn('descricao', 'Nome', 'left', false, '58%', true),
			new MDataGridColumn('estoque', 'Quantidade Total', 'right', false, '10%', true),
			new MDataGridColumn('valortotal', 'Valor Total', 'right', false, '10%', true),
			new MDataGridColumn('estoquemin', 'Estoque Mínimo', 'center', false, '5%', true),
		);
		$this->SetFilter(false);
		$filterNome = Form::GetFormValue('nome');
		//$filterNome = Util::NVL($filterNome, 'A Definir');

		if ($filterNome) {
			if (is_numeric($filterNome)) {
				$query = $this->objUoAlmoxarifado->ListMateriaisByNomeCod($filterNome);
			} else {
				$query = $this->objUoAlmoxarifado->ListMateriaisByNomeCod(strtoupper("%$filterNome%"));
			}
		} else {
			$query = $this->objUoAlmoxarifado->ListMateriaisByNomeCod(strtoupper('%'));
		}

		$this->SetIndex(1);

		$ctlArray = array(
				new FormButton('btnNew', 'Incluir Novo Material', $MIOLO->GetActionURL('adm','main:uoalmoxarifado',$this->objUoAlmoxarifado->idUo,array('form'=>'estoqueinicial','id'=>'new')))
		);

		$href_grid = $MIOLO->GetActionURL('adm', 'main:uoalmoxarifado', $this->objUoAlmoxarifado->idUo, array('form' => 'entrada2006'));
		if ($page->isPostback()) {
			$this->objUoAlmoxarifado->retrieveAssociation('estoque');
		}
		parent::__construct($query, $columns, $href_grid, 15);
		$this->SetTitle(NULL);
		$this->SetWidth('100%');
		$this->SetLinkType('hyperlink');
		$this->SetControls($ctlArray);
		$estorno = Form::GetFormValue('estorno');
                
                //Tiago Macedo 26-06-2012
                //Alteração para o grid ser usado tambem no formulario de baixa de material
                $form = Form::GetFormValue('form');
                if ($form == baixademateriais){
		$action = $this->manager->GetActionURL('adm', 'main:uoalmoxarifado', $this->objUoAlmoxarifado->idUo, array('form' => 'baixademateriais', 'id' => '#0#'));
                }else  $action = $this->manager->GetActionURL('adm', 'main:uoalmoxarifado', $this->objUoAlmoxarifado->idUo, array('form' => 'entrada2006', 'id' => '#0#'));
		$this->AddActionIcon('ID', 'select.gif', $action);
	}

	public function GenerateFooter() {
		if (!$this->data) {
			$footer[] = $this->GenerateEmptyMsg();
		}
		$footer[] = new Separator();
		$footer[] = $this->GenerateControls();
		return $footer;
	}

}
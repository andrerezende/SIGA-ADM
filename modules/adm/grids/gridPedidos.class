<?php
global $MIOLO;
$MIOLO->Uses('controls/linkpedidocompra.class', 'adm');

class gridPedidos extends MDataGrid2 {

	/**
	 * Business utilizado
	 * @var BusinessAdmPedidoCompra
	 */
	public $pedido;
	public $perms;

	public function __construct() {
		global $MIOLO, $module, $page, $context, $self, $action, $perms, $state;

		$this->pedido = $MIOLO->GetBusiness($module, 'pedidocompra');
		$query = $this->pedido->listPedidos(
			MForm::GetFormValue('situacao'),
			MForm::GetFormValue('instituicao'),
			MForm::GetFormValue('numpro'),
			MForm::GetFormValue('data'),
			MForm::GetFormValue('codMaterial'),
			MForm::GetFormValue('codServico'),
			array(
				MForm::GetFormValue('elemento'),
				MForm::GetFormValue('subelemento')
			)
		);

		$this->SetIndex(1);
		$linkPedido = new LinkPedido('linkpedido', '%0%');
		$columns = array(
			new DataGridControl($linkPedido, 'pedido', 'Pedido', '', false, '5%'),
			new MDataGridColumn('instituicao', 'Instituição', '', false, '30%'),
			new MDataGridColumn('usuario', 'Solicitante', '', false, '35%'),
			new MDataGridColumn('setor', 'Setor', '', false, '10%'),
			new MDataGridColumn('data', 'Data', '', false, '10%'),
			new MDataGridColumn('situacao', 'Situação', '', false, '10%'),
		);

		$href_grid = $MIOLO->GetActionURL($module, $self, '', array('event' => 'btnFind'));
		parent::__construct($query, $columns, $href_grid, 25);
	}
}
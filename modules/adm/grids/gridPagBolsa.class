<?
/**
 * Grid Pagamento Bolsista no Mês
 * @package br.org.miolo.ufjf.adm.grids
 */
class gridPagBolsa extends DataGrid2
{
	/**
	 * Base URL
	 * @var string 
	 */
	var $listURL;

	/**
	 * Constructor
	 */
	function gridPagBolsa()
	{
		global $MIOLO, $module, $self, $action, $state, $item;
		
		$aux = explode('_',$item);
		$idbolsa = $aux[0];
		$mesano = $aux[1];
		
		//modificacoes
		$folha = $aux[2];
		
		$this->listURL = $MIOLO->GetActionURL($module,$self,$item);
		$objPagBolsa = $MIOLO->GetBusiness($module,'pagbolsa');
				
		//modificacoes
		$query = $objPagBolsa->ListByMesAnoBolsa($mesano,$idbolsa,$folha);
		
		$columns = array(
			new DataGridColumn('idbolsista','idpagbolsa','left',true,'',false),
			new DataGridColumn('mesano','mesano','left',true,'',false),
			new DataGridColumn('cpf','CPF','left',true,'10%',true),
			new DataGridColumn('nome','Nome','left',false,'60%',true),
			new DataGridColumn('horastrabalhadas','Horas','right',true,'10%',true),	
			new DataGridColumn('banco','Banco','right',true,'5%',true),
			new DataGridColumn('idagenc','Agencia','left',true,'10%',true),
			new DataGridColumn('conta','Conta','left',true,'5%',true),
			new DataGridColumn('valor','Valor','left',true,'10%',true),
	 	);
		
		parent::__construct($query, $columns,$this->listURL,20,0);
		
		$this->AddFilterText('nome','Nome:','');
		
		if (($f = $state->get('filtro')) === NULL) $f = true;
			
		$this->SetFilter($f);
		$state->set('filtro',$f);
		
		
		//modificacaoes
		if ($folha==1)
		 	$texto='Normal';
		elseif ($folha==2)
		 	$texto='Suplementar';
		
		//modificacoes
		$this->SetTitle("Pagamentos de Bolsistas - $mesano :: Bolsa $idbolsa - Tipo de Bolsa: $texto");
		$this->HeaderLink('inicio', 'Formulário Inicial',$MIOLO->GetActionURL($module,'main:pagbolsa'));
		
		$vetDt = explode('/',$mesano);
		$vetDtAt = explode('/',date('d/m/Y'));
			
		/**
		 * Obs: somente no mes corrente e anterior os registros
		 * poderao ser inseridos/alterados/apagados
		 */
		if ( mktime(0,0,0,$vetDt[0],1,$vetDt[1]) >= mktime(0,0,0,$vetDtAt[1],1,$vetDtAt[2]) ) 
		{
			//modificacoes
			$href_edit = $MIOLO->GetActionURL($module,'main:pagbolsa','%0%_%1%_'.$idbolsa.'_'.$folha, array('event'=>'btnEdit:click'));
			$href_dele = $MIOLO->GetActionURL($module,'main:pagbolsa','%0%_%1%'.'_'.$idbolsa.'_'.$folha, array('event'=>'btnDelete:click'));
			
			$this->AddActionUpdate($href_edit);
			$this->AddActionDelete($href_dele);
			
			$this->HeaderLink('novo', 'Novo Pagamento',$MIOLO->GetActionURL($module,'main:listabolsistaporbolsa',$item));
            
            $this->HeaderLink('novobloco', 'Novo Pagamento em Bloco',$MIOLO->GetActionURL($module,'main:listabolsistaporbolsa',$item,array('pgGeral'=>'sim')));
      	}

		$this->HeaderLink('CopiarPagamento','Copiar Pagamento',$MIOLO->GetActionURL($module,'main:pagbolsa','',Array('event'=>'btnPreparaCopiarPag:click','item'=>$item)));
		//$this->setLinkType('linkbutton'); 
		
		$this->SetClose($MIOLO->GetActionURL($module,'main:pagbolsa'));
	}
}
?>

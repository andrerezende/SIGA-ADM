<?php
/**
 * Use Module Control
 */
global $MIOLO;
$MIOLO->Uses('controls/linkpatrimonio.class','adm');

class gridPatrimonio extends DataGrid2
{

	/**
	* Constructor
	*/
	function __construct() {
		global $MIOLO, $self;
		$hrefItemPatrimonio = $MIOLO->getActionURL('adm','itempatrimonio','#0#',array('form'=>'patrimonio'));
		$linkPatrimonio = new LinkPatrimonio('linkpatrimonio','%0%');
		$columns = array(
			new DataGridColumn('idItemPatrimonio','Número','center', true,'10%',true,null,true),
			new MDataGridHyperlink('descricao','Descrição', $hrefItemPatrimonio,'60%',true,null,true),
			//new DataGridControl($linkPatrimonio,'patrimonio','Descrição','left', false,'60%'),
			new DataGridColumn('siglasetor','Setor','center', true,'20%',true,null,true),
			new DataGridColumn('numeroempenho','Empenho','center', true,'10%',true,null,true),
		);
		$this->SetFilter(false);

		$idItemPatrimonio = MForm::GetFormValue('idItemPatrimonio');
		$descricao = strtoupper(MForm::GetFormValue('patrimonio'));
		$classificador = strtoupper(MForm::GetFormValue('classificador'));
		$empenho = strtoupper(MForm::GetFormValue('empenho'));
		$tomboanterior = strtoupper(MForm::GetFormValue('tomboanterior'));
		$cnpj = MForm::GetFormValue('cnpj');
		$notafiscal=MForm::GetFormValue('notafiscal');
		$dataaquisicao=MForm::GetFormValue('dataaquisicao');

		$numeroserie = strtoupper(MForm::GetFormValue('numeroserie'));
		$this->AddFilterText('patrimonio','Item',$patrimonio);
		$this->SetIndex(1);
		$objPatrimonio = $MIOLO->GetBusiness('adm','itempatrimonio');
		$href_grid = $MIOLO->GetActionURL('adm',$self);

		$campos = array(
			$descricao,
			$classificador,
			$empenho, 
			$tomboanterior, 
			$cnpj,
			$numeroserie,
			$dataaquisicao,
			$notafiscal
		);

		$contador = 0;
		for ($i = 0; $i < 8; $i++) {
			if ($campos[$i] != "") {
				$contador++;
			}
		}

		if ($contador == 0) {
			$validador = 1;
		} else {
			$validador=0;
			$this->SetTitle(NULL);
		}

		if ($idItemPatrimonio != '') {
			parent::__construct($objPatrimonio->ListById($idItemPatrimonio), $columns, $href_grid, 25);
		} else {
			parent::__construct($objPatrimonio->Filtrar($campos,$validador), $columns, $href_grid, 25);
		}
		$this->SetLinkType('hyperlink');
	}

	function GenerateFooter() {
		if (!$this->data) {
			$footer[] = $this->GenerateEmptyMsg();
		}
		$footer[] = new Separator();
		$footer[] = $this->GenerateControls();
		return $footer;
	}
}
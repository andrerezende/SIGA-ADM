<?php
class repCapaProcessoEmpenho extends PDFReport
{
	var $img;
	protected $objEmpenho;
	
    function __construct($objEmpenho)
    {
		global $MIOLO, $module, $page, $context, $self, $action, $perms;
		parent::__construct(NULL, NULL, 55);
		$this->objEmpenho =  $objEmpenho;
        $ui = $MIOLO->GetUI();
		$this->img = $ui->GetImageSrc('logonet.png',$module);
	    $this->pdf->ezSetMargins(100, 70,50, 30);
		$this->GeneratePageHeader();
		$this->GeneratePageFooter();
		$this->objEmpenho->retrieveAssociation('processo');
		$cf = new MCurrencyFormatter();
		$h = $this->pdf->getFontHeight(12);
        $this->pdf->ezSetCmMargins(8.5,2.5,3.5,2.5);
		$tipo = array('P'=>'PROCESSO','A'=>'PROTOCOLADO');
		if($this->objEmpenho->processo){
			$this->pdf->ezText($tipo[$this->objEmpenho->processo->tipo],12);	
			$this->pdf->ezText($this->objEmpenho->processo->instituicao. '.'.$this->objEmpenho->processo->numProcessoFormatado(),24);
			$entrada=$this->objEmpenho->processo->dataFormatada($this->objEmpenho->processo->dataAbertura);
		}
		$options['textCol'] = array(0,0,0);
		$options['shaded'] = 0;
		$options['showLines'] = 0;
		$options['fontSize'] = 12;
		$options['maxWidth'] = 480;
		$options['xPos'] = 'left';
		$options['xOrientation'] = 'right';
		$cols = array('','');
		$dataRel[] = array('INTERESSADO:',$this->objEmpenho->processo->solicitante);
		$dataRel[] = array('','');
		$dataRel[] = array('ENTRADA SISTEMA:',$entrada);
		$dataRel[] = array('','');
		$dataRel[] = array('SETOR ORIGEM:',$this->objEmpenho->processo->setorOrigem);
		$dataRel[] = array('','');
		$dataRel[] = array('TÍTULO:',$this->objEmpenho->processo->titulo);
		$dataRel[] = array('','');
		$dataRel[] = array('ASSUNTO:',$this->objEmpenho->processo->assunto);
		$this->pdf->ezTable($dataRel,$cols,'',$options);
		$this->pdf->ezTable($data,$cols,'',$options);
	    $this->Execute();
	}

        

        function GeneratePageHeader()
        {
			$x0 = $this->pdf->left-5;
			$x1 = $this->pdf->right-5;
			$h = $this->pdf->getFontHeight(12);
			$header = $this->pdf->openObject();
			$this->pdf->saveState();
//			$this->pdf->addPngFromFile($this->img, $x0, 770, 50, 50);
			$alturaCabecalho = $x0 + 58;

		$x0=$this->pdf->left;	
		$this->pdf->addText($x0, 800, 12, $this->manager->getConf('instituicao.sigla')." - ".$this->manager->getConf('instituicao.nome'));
		$this->pdf->addText($x0, 800 - $h, 12, $this->manager->getConf('theme.system'));


/*			$this->pdf->addText($alturaCabecalho, 800, 12, 'UFJF - Universidade Federal de Juiz de Fora');
			$this->pdf->addText($alturaCabecalho, 800 - $h, 12, 'CGCO - Centro de Gestão do Conhecimento Organizacional');
			$this->pdf->addText($alturaCabecalho, 800 - $h - $h, 12, 'SIGA - Sistema Integrado de Gestão Acadêmica');*/


			$this->pdf->addText($alturaCabecalho, 800 - $h - $h- $h, 12, '');
			$this->pdf->SetStrokeColor(0, 0, 0);
			$y = 800 - $h - $h- $h;
			$this->pdf->restoreState();
			$this->pdf->closeObject();
			$this->pdf->addObject($header, 'all');
			$this->pdf->ezSetDy(+15);
	
        }

		function GeneratePageFooter()
        {
          	$x0 = $this->pdf->left;
			$x1 = $this->pdf->right;
			$footer = $this->pdf->openObject();
			$this->pdf->saveState();
			$this->pdf->SetStrokeColor(0, 0, 0);
			$this->pdf->line($x0, 28, $x1, 28);
			//$this->pdf->addText($x0, 19, 9, $this->timestamp . ' - CGCO/DSI');
			$this->pdf->restoreState();
			$this->pdf->closeObject();
			$this->pdf->addObject($footer, 'all');
        }
    
        
    
    }
?>

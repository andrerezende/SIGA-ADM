<?php
class repExecucaoFinanceiraSintetico extends PDFReport
{
	var $img;
	var $timestamp;
	var $dataInicial;
	var $dataFinal;
	var $objRequisicao;
	var $tipo;

	function __construct($tipo)
	{
		global $MIOLO, $module, $page, $context, $self, $action, $perms, $item;

		$ui = $MIOLO->GetUI();
		$this->img = $ui->GetImageSrc('logo_siga.png',$module); 
		$this->tipo = $tipo;

		$this->dataInicial = Form::GetFormValue('calDataInicial');
		$this->dataFinal = Form::GetFormValue('calDataFinal');

		$columns = array(
    		new PDFReportColumn('1','<b><i>UO</i></b>','left',true,9,true,null,true),
    		new PDFReportColumn('2','<b><i>Aliment.</i></b>','right',false,9,true,null,true),
    		new PDFReportColumn('3','<b><i>Diária</i></b>','right',true,9,true,null,true),
    		new PDFReportColumn('4','<b><i>Hosped.</i></b>','right',false,9,true,null,true),
    		new PDFReportColumn('5','<b><i>Pas. Aérea</i></b>','right',true,9,true,null, true),
    		new PDFReportColumn('6','<b><i>Pas. Terrestre</i></b>','right',true,9,true,null,true),
    		new PDFReportColumn('7','<b><i>Compra</i></b>','right',true,9,true,null,true),
    		new PDFReportColumn('8','<b><i>Almox.</i></b>','right',true,9,true,null,true),
    		new PDFReportColumn('9','<b><i>Serviço Externo</i></b>','right',true,9,true,null,true),
    		new PDFReportColumn('10','<b><i>Veículo</i></b>','right',true,9,true,null,true),
    		new PDFReportColumn('11','<b><i>Total</i></b>','right',true,10,true,null,true),
	    );
       
		$this->objRequisicao = $MIOLO->GetBusiness($module,'requisicao');
		$data = $this->objRequisicao->repExecucaoFinanceiraSintetico($this->dataInicial, $this->dataFinal, $this->tipo);

		parent::__construct($data,$columns,40);

	    $this->SetOption('showTableTitle',0);
        $this->SetOption('fontSize',7);
		$this->SetOption('showLines',0);
	    $this->timestamp = date('d/m/Y');
	}

	function GeneratePageHeader()
	{
		$this->dataInicial = Form::GetFormValue('calDataInicial');
		$this->dataFinal = Form::GetFormValue('calDataFinal');
		$x0 = $this->pdf->left;
		$x1 = $this->pdf->right;
		$h = $this->pdf->getFontHeight(12);
		$header = $this->pdf->openObject();
		$this->pdf->saveState();

		$x00=$this->pdf->left;
		$hh = $this->pdf->getFontHeight(12);
		$this->pdf->addText($x00, 800, 12, $this->manager->getConf('instituicao.sigla')." - ".$this->manager->getConf('instituicao.nome'));
		$this->pdf->addText($x00, 800 - $hh, 12, $this->manager->getConf('theme.system'));
		
/*$this->pdf->addPngFromFile($this->img, $x0, 780, 50, 25);
		$this->pdf->addText($x0 + 60, 800, 12, 'UFJF - Universidade Federal de Juiz de Fora');
		$this->pdf->addText($x0 + 60, 800 - $h, 12, 'CGCO - Centro de Gestão do Conhecimento Organizacional');
		$this->pdf->addText($x0 + 60, 800 - $h - $h, 12, 'SIGA - Sistema Integrado de Gestão Acadêmica');
*/
		$this->pdf->SetStrokeColor(0, 0, 0);
		$y = 800 - $h - $h - 5;
		$this->pdf->line($x0, $y, $x1-10, $y);
		$this->pdf->addText($x0, $y - 13, 12, "Relatório de Execução Financeira Sintético ($this->tipo) - Período: de $this->dataInicial a $this->dataFinal");
		$this->pdf->line($x0, $y - 15, $x1-10, $y - 15);
		$this->pdf->restoreState();
		$this->pdf->closeObject();
		$this->pdf->addObject($header, 'all');
		$this->pdf->ezSetY(770);
	}

	function GeneratePageFooter()
	{
		$x0 = $this->pdf->left;
		$x1 = $this->pdf->right;
		$footer = $this->pdf->openObject();
		$this->pdf->saveState();
		$this->pdf->SetStrokeColor(0, 0, 0);
		$this->pdf->line($x0, 28, $x1, 28);
		$this->pdf->addText($x0, 19, 9, $this->timestamp . ' - CGCO/DSI');
		$this->pdf->restoreState();
		$this->pdf->closeObject();
		$this->pdf->addObject($footer, 'all');
	}
}
?>

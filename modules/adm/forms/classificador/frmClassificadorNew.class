<?
class frmClassificadorNew extends Form
{
    function __construct()
    {
        $this->Form('Incluir Novo Classificador');
        $this->EventHandler();
    }

    function CreateFields()
    {
        $fields = array (
            new TextField('idClassificador','','Código','20', 'Máx. 12 caracteres'),
            new TextField('descricao','','Descricao','50','Máx. 50 caracteres'),
        );
		
        $this->SetFields($fields);
	      
	$buttons = array (
            new FormButton('btnNew', 'Cadastrar Classificador')
        );
        $this->SetButtons($buttons);

        $validators = array (
            new RequiredValidator('idClassificador'),
            new RequiredValidator('descricao'),
        );
        $this->SetValidators($validators);
    }

	function btnNew_click()
	{
		$codigo = Form::GetFormValue('idClassificador');
		$descricao = Form::GetFormValue('descricao');

		if(strlen(trim($codigo))< 4){
			$this->AddError('O código deve possuir pelo menos quatro caracteres.');
		}
		elseif(strlen(trim($descricao))< 3){
			$this->AddError('A descrição deve ter pelo menos três caracteres.');
		}
		else
		{
		      $data = $this->GetData();

		      $classificador = $this->manager->GetBusiness('adm','classificador');
		      $classificador->SetData($data);
		      try
		      {
			      $classificador->idClassificador = strtoupper($classificador->idClassificador);
			      $classificador->descricao = strtoupper($classificador->descricao);
			      $classificador->save();
			      $classificador->Log(OP_INS,"Novo classificador criado");
			      $go = $this->manager->GetActionURL('adm','main:classificador',$classificador->idClassificador);
			      $this->manager->Information('Classificador criado com sucesso.',$go);
			      
		      }
		      catch (Exception $e)
		      {
			      $this->addError($e->getMessage());
		      }
		}
	}

}
?>

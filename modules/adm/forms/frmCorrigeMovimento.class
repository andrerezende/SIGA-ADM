<?
global $MIOLO;
/**
 * Use Module Control
 */
$MIOLO->Uses('controls/linkliquidacao.class','adm');

/**
 * Formulário básico para seleção de liquidacaos
 * 
 */
class frmCorrigeMovimento extends Form
{
    function __construct()
    {
		global $MIOLO, $module;
		
        $this->Form('Corrige Movimento');
		//$this->SetClose($MIOLO->GetActionURL($module,'main:manutencao'));
        $this->EventHandler();
    }

    function CreateFields()
    {
        global $MIOLO, $action;
        $ui = $this->manager->getUi();
        
         $login = $this->manager->GetLogin();        
        if ($login->id != "romero.freire") exit;
            
        $fields = array(
                new MTextField('idMaterial','','Id do material',7),
                new MTextField('uo','','Id da UO',7),

            );
        $buttons = array(new FormButton('btnPost', 'Executar'));
        $this->setFields($fields);
        
        
        $this->setButtons($buttons);        

    }
    
	function btnPost_click()
	{
            global $item, $MIOLO, $module;
            
		$idMaterial = $this->getFormValue('idMaterial');
                $uo = $this->getFormValue('uo');
                
                $objMovimento = $MIOLO->GetBusiness($module, 'movimento'); 
                try {
                    $objMovimento->corrigeTudo($idMaterial, $uo);
                    $this->manager->Information('Material atualizado com sucesso.', $go);
                    } catch (Exception $e) {
                        $this->AddError('Não foi possível realizar a operação. Motivo: ' . $e->getMessage());
                }
	}
 }
?>

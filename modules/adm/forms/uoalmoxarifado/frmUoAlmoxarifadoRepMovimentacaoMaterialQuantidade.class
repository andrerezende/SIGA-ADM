<?
// 20-12-2011 - DAniel Bonfim
class frmUoAlmoxarifadoRepMovimentacaoMaterialQuantidade extends MForm
{
    var $uoalmoxarifado;
    function __construct($uoalmoxarifado)
    {
 	    global $MIOLO, $module, $self;
        $this->uoalmoxarifado = $uoalmoxarifado;
 	    parent::__construct('Relatório de Movimentação de Almoxarifado / Material por Quantidade');
 	    $this->eventHandler();
    }
    function CreateFields()
    {
        // 28-10-2011 - Daniel Bonfim
        $fields = array(
            new MSelection('mesReferencia', '','Mês referência',$this->geraMeses()),
            new MSelection('anoReferencia', '','Ano referência',$this->geraAnos()),
            new MLookupTextField('notafiscal', '', 'Nota Fiscal', 50, NULL, NULL, NULL, 'adm', 'notafiscal2'),
		);
        /*$fields = array
        (
			new MCalendarField('dataInicio',date('d/m/Y'),'Data Inicial',10,'informe a data inicial do relatório.'),
			new MCalendarField('dataFim',date('d/m/Y'),'Data Final',10,'informe a data final do relatório.'),
        );
         * 
         */
        $this->setFields($fields);
        
        $this->SetFieldAttr('notafiscal', 'related', 'notafiscal');
        
	    $buttons = array(
	        //new MButton('btnRelatorio','Gerar Relatório','PDF'),
                new MButton('btnRelatorio','Gerar Relatório'),
	    );
        $this->setButtons($buttons);
    }
    // 28-10-2011 - Daniel Bonfim
    public function geraMeses() {
        global $MIOLO;
        $meses = array(
            1 => 'Janeiro',
            2 => 'Fevereiro',
            3 => 'Março',
            4 => 'Abril',
            5 => 'Maio',
            6 => 'Junho',
            7 => 'Julho',
            8 => 'Agosto',
            9 => 'Setembro',
            10 => 'Outubro',
            11 => 'Novembro',
            12 => 'Dezembro',
        );
        return $meses;
    }
// 28-10-2011 - Daniel Bonfim
    public function geraAnos() {
        $anos = array();
        $anoAtual = date('Y');
        $anoInicial = 1970;
        for ($i = $anoAtual; $i >= $anoInicial; --$i) {
            $anos[(int) $i] = (int) $i;
        }
        return $anos;
    }
    
    function btnRelatorio_click() {   
        $mesReferencia = Form::getFormValue('mesReferencia');
        $anoReferencia = Form::getFormValue('anoReferencia');
        $notaFiscal = Form::getFormValue('notafiscal');
        
        $tipo = "MATERIAL";
        $filtradoPor = "QUANTIDADE";
        
        if(!$mesReferencia) {
            $this->addError("Selecione o mês");
            return;
        }
        if(!$anoReferencia) {
            $this->addError("Selecione o ano");
            return;
        }
        
        $idUoAlmoxerifado = $this->uoalmoxarifado->idUo;
        header("Location: http://".$_SERVER['HTTP_HOST']."/relatorios2/repRMA.php?tipo=$tipo&filtradoPor=$filtradoPor&idUoAlmoxerifado=$idUoAlmoxerifado&mes=$mesReferencia&ano=$anoReferencia&notaFiscal=$notaFiscal");
        
        
    }
}
?>

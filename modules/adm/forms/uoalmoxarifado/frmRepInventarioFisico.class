<?
// 20-12-2011 - DAniel Bonfim
class frmRepInventarioFisico extends MForm
{
    var $uoalmoxarifado;
    function __construct($uoalmoxarifado)
    {
 	    global $MIOLO, $module, $self;
        $this->uoalmoxarifado = $uoalmoxarifado;
 	    parent::__construct('Inventário Físico');
 	    $this->eventHandler();
    }
    function CreateFields()
    {
		global $MIOLO, $module, $self;

	$listaSubelemento=$MIOLO->GetBusiness('adm','subelemento');
	$listaSubelemento=$listaSubelemento->ListAll339030();

	$fields = array(
            new MSelection('mesReferencia', '','Mês referência',$this->geraMeses()),
            new MSelection('anoReferencia', '','Ano referência',$this->geraAnos()),
           // new MSelection('subelemento', '','Subelemento',$listaSubelemento->result),

		);

	$this->setFields($fields);
	$this->SetFieldAttr('notafiscal', 'related', 'notafiscal');

	$buttons = array(
		new MButton('btnRelatorio','Gerar Relatório'),
	    );
	$this->setButtons($buttons);
    }

    public function geraMeses() {
        global $MIOLO;
        $meses = array(
            1 => 'Janeiro',
            2 => 'Fevereiro',
            3 => 'Março',
            4 => 'Abril',
            5 => 'Maio',
            6 => 'Junho',
            7 => 'Julho',
            8 => 'Agosto',
            9 => 'Setembro',
            10 => 'Outubro',
            11 => 'Novembro',
            12 => 'Dezembro',
        );
        return $meses;
    }
// 28-10-2011 - Daniel Bonfim
    public function geraAnos() {
        $anos = array();
        $anoAtual = date('Y');
        $anoInicial = 1970;
        for ($i = $anoAtual; $i >= $anoInicial; --$i) {
            $anos[(int) $i] = (int) $i;
        }
        return $anos;
    }

    function btnRelatorio_click() {
	$mesReferencia	= Form::getFormValue('mesReferencia');
	$anoReferencia	= Form::getFormValue('anoReferencia');
	$subelemento	= Form::getFormValue('subelemento');
	$uo			=$this->uoalmoxarifado->nome;

	$tipo = "MATERIAL";
	$filtradoPor = "VALOR TOTAL";

        if(!$mesReferencia) {
            $this->addError("Selecione o mês");
            return;
        }
        if(!$anoReferencia) {
            $this->addError("Selecione o ano");
            return;
        }

        $idUoAlmoxerifado = $this->uoalmoxarifado->idUo;
       // header("Location: http://".$_SERVER['HTTP_HOST']."/relatorios2/view/almoxerifado/vw_inventarioFisico.php?tipo=$tipo&filtradoPor=$filtradoPor&idUoAlmoxerifado=$idUoAlmoxerifado&mes=$mesReferencia&ano=$anoReferencia&subelemento=$subelemento");
	$this->page->AddJsCode('window.open("http://'.$_SERVER['HTTP_HOST'].'/relatorios2/view/almoxerifado/vw_inventarioFisico.php?'."tipo=$tipo&filtradoPor=$filtradoPor&idUoAlmoxerifado=$idUoAlmoxerifado&mes=$mesReferencia&ano=$anoReferencia&subelemento=$subelemento&uo=$uo".'");');

    }
}
?>

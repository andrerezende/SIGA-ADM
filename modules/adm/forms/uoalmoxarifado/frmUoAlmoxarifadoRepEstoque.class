<?php
class frmUoAlmoxarifadoRepEstoque extends MForm {

    private $objUO;
    private $idUO;
    private $uo;
    private $item2;
	public function __construct($obj) {
		$this->defaultButton = false;
		$this->objUO=$obj;
		$this->idUO=$this->objUO->idUo;
                $this->uo=$this->objUO->sigla;
		parent::__construct('Relatório do Estoque');
		$this->EventHandler();
	}

	public function CreateFields() {
		global $MIOLO, $module, $action, $item, $theme;
		$this->item2=$item;

        $fields = array(
            new MHiddenField('idMaterial', $this->objEstoque->idMaterial, 'Idmaterial'),
			new MLookupTextField('lkpMaterial', $this->objEstoque->material->descricao, 'Material', 40),
			new MHiddenField('estoque', $this->objEstoque->estoque, 'Quantidade Total', 10, 'Ex: 1000'),
			new MHiddenField('valorTotal', $this->objEstoque->valorTotal, 'Valor Total', 10, 'Ex: 45,00'),
		);

		$this->SetFields($fields);

		$this->SetFieldAttr('lkpMaterial', 'module', 'adm');
		$this->SetFieldAttr('lkpMaterial', 'item', 'material');
		$this->SetFieldAttr('lkpMaterial', 'event', 'filler');
		$this->SetFieldAttr('lkpMaterial', 'related', 'idMaterial,lkpMaterial');

        $buttons = array(
			new MButton('btnPost', 'Gerar Relatório', ''),
		);
		$this->SetButtons($buttons);
	}

	public function btnPost_click() {
		$data = $this->getData();                
		if ($data->idMaterial == null) {
			$this->addError('Escolha o material.');
			return;
		}
		$id=$this->idUO;
                $uo=$this->uo;
		$idMaterial=urlencode($this->GetFieldValue('idMaterial'));
		$fields = array(
			new MHiddenField('idMaterial', '', 'Idmaterial'),
			new MLookupTextField('lkpMaterial', '', 'Material', 40),
			new MHiddenField('estoque', '', 'Quantidade Total', 10, 'Ex: 1000'),
			new MHiddenField('valorTotal', '', 'Valor Total', 10, 'Ex: 45,00'),
		);

		$this->SetFields($fields);
		//$this->CreateFields();
                //$this->page->AddJsCode('window.open("http://'.$_SERVER['HTTP_HOST'].'/relatorios2/view/almoxerifado/vw_listamaterial.php?idUoAlmoxerifado='.$uoalmoxarifado->idUo.'&uo='.$uoalmoxarifado->sigla.'");');                                
		//header("Location: http://".$_SERVER['HTTP_HOST']."/relatorios/estoque.php?idMaterial=$idMaterial&idUO=$id");
		$this->page->AddJsCode('window.open("http://'.$_SERVER['HTTP_HOST'].'/relatorios/estoque.php?idMaterial='.  urlencode($idMaterial)."&idUO=$id&uo=$uo".'");');


	}

}
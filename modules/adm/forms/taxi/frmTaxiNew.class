<?
MIOLO::Import('modules::adm::forms::taxi::frmTaxiPai');

class frmTaxiNew extends frmTaxiPai
{
	function __construct()
	{
		$this->Form('Incluir Novo Taxi');
		$this->EventHandler();
	}

	function CreateFields()
	{
		$this->CommonFields();
		$buttons = array
		(
			new FormButton("btnNew","Cadastrar Valor")
		);

		$this->SetButtons($buttons);
	}

	function btnNew_click()
	{
		$data = $this->GetData();
		$taxi = $this->manager->GetBusiness('adm','taxi');
		$taxi->SetData($data);
		$taxi->valor = str_replace(',', '.', $taxi->valor);
		
		if($taxi->dataIni == ''){
			$this->AddError("Selecione a Data Início.");
		}
		elseif($taxi->dataFim == ''){
			$this->AddError("Selecione a Data Fim.");
		}
		elseif($taxi->valor == ''){
			$this->AddError("Informe o valor do Taxi.");
		}
		elseif($taxi->dataFim < $taxi->dataIni){
			$this->AddError("A Data fim não deve ser anterior a Data Início.");
		}
		elseif($taxi->valor < 0){
			$this->AddError("O valor do Taxi não pode ser negativo.");
		}
		else
		{
			try
			{
				$taxi->save();
				$taxi->Log(OP_INS,"Novo Taxi criado");
				$go = $this->manager->GetActionURL('adm','main:taxi:find',$taxi->dataIni);
				$this->manager->information("Valor de taxi cadastrado com sucesso.",$this->manager->getActionUrl('adm','main:taxi:find') );
			}
			catch (Exception $e)
			{
				$this->addError($e->getMessage());
			}
		}
	}
}
?>

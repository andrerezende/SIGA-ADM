<?
class frmPrevRevisaoDados extends Form
{

	protected $objPR;
	
    function __construct($objPR)
    {	
	$this->objPR = $objPR;
        $this->Form('Previsão');
        $this->EventHandler();
    }

    function CreateFields()
    {
       global $MIOLO;

		$situacao = array(
				"1"=>"PREVISTA",
				"2"=>"FINALIZADA");
			$fields = array(
		new MHiddenField('placa'),
		new LookupTextField('lkpVeiculo','','Veículo','40'),
		new MCalendarField('dataPrevista','','Data Prevista','10'),
		//new MTextField('kmEstimada','','KM Estimada','10'),
		new MSelection ('situacao',$this->objPR->situacao,'Situação',$situacao),
		new MultiLineField('obs','','OBS'),
					);

	$buttons = new MButton('btnEnviar');
	$this->SetFields($fields);
	$this->SetButtons($buttons);

	$this->SetFieldAttr('lkpVeiculo','module','adm');
	$this->SetFieldAttr('lkpVeiculo','item','veiculo');
	$this->SetFieldAttr('lkpVeiculo','event','filler');
	$this->SetFieldAttr('lkpVeiculo','related','null,placa,lkpVeiculo,null');

	$this->SetFieldValue('placa',$this->objPR->placa);
	$this->SetFieldValue('lkpVeiculo',$this->objPR->placa);
	$this->SetFieldValue('dataPrevista',$this->objPR->dataPrevista);
	$this->SetFieldValue('obs',$this->objPR->obs);
	//$this->SetFieldValue('kmEstimada',$this->objPR->kmEstimada);
	
	if ($this->objPR->situacao = "2")
	{
		$this->setFieldAttr('lkpVeiculo','readonly',true);
		$this->setFieldAttr('dataPrevista','readonly',true);
		$this->setFieldAttr('obs','readonly',true);
		//$this->setFieldAttr('kmEstimada','readonly',true);
		$this->setFieldAttr('situacao','readonly',true);
		$this->setButtonAttr('btnEnviar','visible',false);
	}
    }

    function btnEnviar_click()
    {
		global $MIOLO;
		$data = $this->getData();
		$this->objPR->setData($data);
		try
		{
			$this->objPR->Save();
			$msg = "Previsão Editada com sucesso";
			$this->manager->Information($msg,$this->manager->GetActionURL('adm','prevrevisao:find'));
		}
		catch(Exception $e)
		{
			$this->manager->Error($e->getMessage());
		}
   }
}
?>
<?
class frmRestauranteNew extends Form
{
	function __construct()
	{
		$this->Form('Incluir Novo Restaurante');
		$this->EventHandler();
	}

	function CreateFields()
	{
		$fields = array(
			new TextField('nome','','Nome','30','MÃ¡x. 30 caracteres'),
			new Selection('ativo','','Ativo')
		);

		$this->SetFields($fields);

		$buttons = array(
			new FormButton('btnNew', 'Cadastrar Restaurante')
		);

		$this->SetButtons($buttons);

		$validators = array(
			new RequiredValidator('nome'),
		);

		$this->SetValidators($validators);
	}


	function btnNew_click()
	{
		$nome =  Form::GetFormValue("nome");

		if(strlen(trim($nome))<5)
		{
			$this->AddError("O nome do restaurante deve possuir mais que quatro caracteres");
		}
		else
		{
			$data = $this->GetData();
			$data->nome = strtoupper($data->nome);

			$restaurante = $this->manager->GetBusiness('adm','restaurante');
			$restaurante->SetData($data);
			try
			{
				$restaurante->save();
				$restaurante->Log(OP_INS,"Novo restaurante criado");
				$go = $this->manager->GetActionURL('adm','main:restaurante:find',$restaurante->idRestaurante);
				$this->manager->Information('Restaurante criado com sucesso.',$go);
			}
			catch (Exception $e)
			{
				$this->addError($e->getMessage());
			}
		}
	}

}
?>

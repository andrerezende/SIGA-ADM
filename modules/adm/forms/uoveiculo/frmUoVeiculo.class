<?php
class frmUoVeiculo extends MCompoundForm {

	protected $oid;
	protected $uoVeiculo;

	public function __construct($objUoVeiculo) {
		$this->uoVeiculo = $objUoVeiculo;
		parent::__construct($this->uoalmoxarifado->nome);
		$this->SetTitle($this->uoalmoxarifado->nome);
	}

	public function CreateFields() {
		global $MIOLO, $page, $module, $context, $action, $history,$item;
		$login = $MIOLO->GetLogin();
                $session = $MIOLO->getSession();
                $session->setValue('form', '');
		$uoveiculo = $this->uoVeiculo;
		if ($this->oid == NULL) $this->oid = $uoveiculo->idUo;
                
		parent::CreateFields();
		$ui = $this->manager->GetUI();
		$form = Form::GetFormValue('form');

		$fields=array(
		    new MTextLabel('iduo', $this->uoVeiculo->idUo, 'Nº da UO'),
		    new MTextLabel('iduo', $this->uoVeiculo->nome, 'Nome da UO'),
		    new MTextLabel('user', $login->user, 'Usuário'),
		    new MSpacer(0.5),
		    new MSeparator(''),
		    new MSpacer(1),
		);
		$this->AddFields($fields);
		switch ($form) {
			case 'reqabastecimento':
					$this->_form[0] = $ui->GetForm('adm','frmRequisicaoFindVeiculoAbastecimento',$uoalmoxarifado,'uoveiculo');
				
				break;
                        case 'reqestorno':
				$this->_form[0] = $ui->GetForm('adm','frmRequisicaoFindVeiculoEstorno',$material,'uoveiculo');
				break;        
			case 'reqretorno':
				$this->_form[0] = $ui->GetForm('adm','frmRequisicaoFindVeiculoRetorno',$material,'uoveiculo');
				break;                                
			case 'estoqueinicial':
				if (($id = Form::GetFormValue('id')) != NULL) {
					$material = $uoalmoxarifado->GetMaterial($id);
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoEstoqueInicial',$material,'uoalmoxarifado');
				} else {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoEstoqueInicialFind',$uoalmoxarifado,'uoalmoxarifado');
				}
				break;
			case 'entradamaterial':
				if (Form::getFormValue('idEmpenho')) {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoEntradaMaterialEmpenho',$uoalmoxarifado,'uoalmoxarifado');
				} else {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoEntradaMaterialEmpenhosFind',$uoalmoxarifado,'uoalmoxarifado');
				}
				break;
			case 'entradamaterial2':
                if (Form::getFormValue('idEmpenho')) {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoEntradaMaterialEmpenho2',$uoalmoxarifado,'uoalmoxarifado');
				} else {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoEntradaMaterialEmpenhosFind2',$uoalmoxarifado,'uoalmoxarifado');
				}
				break;
			case 'estornoentradamaterial':
				if (Form::getFormValue('idEmpenho')) {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoEstornoEntrada',$uoalmoxarifado,'uoalmoxarifado');
				} else {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoEstornoEntradaEmpenhosFind',$uoalmoxarifado,'uoalmoxarifado');
				}
				break;
			case 'saidamaterial':
				if (Form::getFormValue('idRequisicao')) {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoSaidaMaterial',$uoalmoxarifado,'uoalmoxarifado');
				} else {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoSaidaMaterialRequisicoesFind',$uoalmoxarifado,'uoalmoxarifado');
				}
				break;
			case 'estornosaidamaterial':
				if (Form::getFormValue('idRequisicao')) {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoEstornoSaida',$uoalmoxarifado,'uoalmoxarifado');
				} else {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoEstornoSaidaRequisicoesFind',$uoalmoxarifado,'uoalmoxarifado');
				}
				break;
			case 'veiculo';
                                $this->_form[0] = $ui->GetForm('adm','frmVeiculoFind',$uoalmoxarifado,'uoveiculo');
                                break;
			case 'ordementrega':
				if (Form::getFormValue('idOrdemEntrega')) {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoOrdemEntrega',$uoalmoxarifado,'uoalmoxarifado');
				} else {
					$this->_form[0] = $ui->GetForm('adm','frmUoAlmoxarifadoOrdemEntregaRequisicoesFind',$uoalmoxarifado,'uoalmoxarifado');
				}
				break;
                        case 'notafiscal';
                                $this->_form[0] = $ui->GetForm('adm','frmRelatorioNotaFiscal',$uoalmoxarifado,'uoalmoxarifado');
                                break;        
			case 'reqsaida':
                            $this->_form[0] = $ui->GetForm('adm','frmRequisicaoFindVeiculoSaida',$uoalmoxarifado,'uoveiculo');
				break;
			case 'mapinspecao':
				$this->_form[0] = $ui->GetForm('adm','frmRepMapInspecaoVeiculo',$uoalmoxarifado,'uoveiculo');
				break;
			case 'listamateriais':
                                $this->page->AddJsCode('window.open("http://'.$_SERVER['HTTP_HOST'].'/relatorios2/view/almoxerifado/vw_listamaterial.php?idUoAlmoxerifado='.$uoalmoxarifado->idUo.'&uo='.$uoalmoxarifado->sigla.'");');                                
				break;
                        case 'matEstoqueMin':  			
                                $this->page->AddJsCode('window.open("http://'.$_SERVER['HTTP_HOST'].'/relatorios2/view/almoxerifado/vw_estoquemin.php?idUoAlmoxerifado='.$uoalmoxarifado->idUo.'&uo='.$uoalmoxarifado->sigla.'");');                                
				break;    
			case 'motorista':
				$this->_form[0] = $ui->GetForm('adm','frmMotoristaFind',$uoalmoxarifado,'uoveiculo');
				break;
			case 'mapabastecimento':
				$this->_form[0] = $ui->GetForm('adm','frmReqAbastecimento',$uoalmoxarifado,'uoveiculo');
				break;
                        case 'maprequisicao':
                                $this->_form[0] = $ui->GetForm('adm','frmRepMapRequisicao',$uoalmoxarifado,'uoveiculo');
				break;
                        case 'endereco':
                            $this->_form[0] = $ui->GetForm('adm','frmEnderecoFind','','uoveiculo');
                            break;
			case 'mapmotorista':
				$this->_form[0] = $ui->GetForm('adm','frmRepMapUtilizacaoMotorista',$uoalmoxarifado,'uoveiculo');
				break;
                        case 'mapveiculo':
				$this->_form[0] = $ui->GetForm('adm','frmRepMapUtilizacaoVeiculo','','uoveiculo');
				break;
			case 'inspecao':
                                $uo = $this->manager->GetBusiness('adm','uo', $item);
                                $this->_form[0] = $ui->GetForm('adm','frmInspecaoFind',$uo,'inspecao1');
                            //('adm','main:inspecao:final',$idUoExecutor)
				break;
                        case 'reqliberar':
                                $this->_form[0] = $ui->GetForm('adm','frmRequisicaoFindVeiculoLiberar','','uoveiculo');
                                break;

		}
		$action = $this->manager->context->action;
		if($form=="" || $form==reqabastecimento || $form==reqestorno || $form=="reqsaida" || $form=="inspecao" || $form=="saidamaterial" || $form=="reqliberar" || $form=="reqretorno"){
		$this->_panel[0] = $panel = new ActionPanel('pnlCompound','Opções','Operações',false);

		$panel->SetTitle('Opções');//Liberar, Saída, Retorno, Estorno, Abastecimento, Inspeção.
                $panel->InsertUserAction(0,'AD_EXEC_VEICULO',A_EXECUTE,'Inspeção',$ui->GetImageTheme('', 'icons/carroManutencao.png'),'adm',$action, $this->oid, array("form"=>"inspecao"));
                $panel->InsertUserAction(0,'AD_EXEC_VEICULO',A_EXECUTE,'Abastecimento',$ui->GetImageTheme('','icons/abst_veiculo.png'),'adm',$action, $this->oid, array("form"=>"reqabastecimento"));
                $panel->InsertUserAction(0,'AD_EXEC_VEICULO',A_EXECUTE,'Estorno',$ui->GetImageTheme('','icons/estorno_vcl.png'),'adm',$action, $this->oid, array("form"=>"reqestorno"));
                $panel->InsertUserAction(0,'AD_EXEC_VEICULO',A_EXECUTE,'Retorno',$ui->GetImageTheme('','icons/veiculos_ger.png'),'adm',$action, $this->oid, array("form"=>"reqretorno"));
                $panel->InsertUserAction(0,'AD_EXEC_VEICULO',A_EXECUTE,'Saída',$ui->GetImageTheme('','icons/saida_veiculo.png'),'adm',$action, $this->oid, array("form"=>"reqsaida"));
                $panel->InsertUserAction(0,'AD_EXEC_VEICULO',A_EXECUTE,'Liberar',$ui->GetImageTheme('','icons/liberar.png'),'adm',$action, $this->oid, array("form"=>"reqliberar"));
		}

		if($form==""  || $form=="matEstoqueMin" || $form=="repEstoque" || $form=="mapinspecao" || $form=="maprequisicao" ||$form=="mapabastecimento" || $form=="mapmotorista" || $form=="mapveiculo"  ){
		$this->_panel[1] = $panel2 = new ActionPanel('pnlRepCompras','Relatórios');
                
		$panel2->InsertUserAction(0,'AD_REL_VEICULOS',A_EXECUTE,'Mapa de Utilização de Veículo',$ui->GetImageTheme('','icons/relatorio.png'),'adm',$action, $this->oid, array("form"=>"mapveiculo"));
                $panel2->InsertUserAction(0,'AD_REL_VEICULOS',A_EXECUTE,'Mapa de Utilização de Motorista',$ui->GetImageTheme('','icons/relatorio.png'),'adm',$action, $this->oid, array("form"=>"mapmotorista"));
                $panel2->InsertUserAction(0,'AD_REL_VEICULOS',A_EXECUTE,'Abastecimento',$ui->GetImageTheme('','icons/relatorio.png'),'adm',$action, $this->oid, array("form"=>"mapabastecimento"));
                $panel2->InsertUserAction(0,'AD_REL_VEICULOS',A_EXECUTE,'Imprimir Requisição',$ui->GetImageTheme('','icons/relatorio.png'),'adm',$action, $this->oid, array("form"=>"maprequisicao"));
                $panel2->InsertUserAction(0,'AD_REL_VEICULOS',A_EXECUTE,'Imprimir Inspeção',$ui->GetImageTheme('','icons/relatorio.png'),'adm',$action, $this->oid, array("form"=>"mapinspecao"));
                


		}

		if($form=="" || $form=="endereco" || $form=="motorista" || $form=="veiculo"){

		$panel3 = new ActionPanel('contabeis','Cadastros',false);
		$this->_panel[2]=$panel3;
		$panel3->InsertUserAction(0,'AD_EXEC_VEICULO',A_EXECUTE,'Endereço',$ui->GetImageTheme('','icons/altera_material_de_requisicao.png'),'adm',$action, $this->oid, array("form"=>"endereco"));
		$panel3->InsertUserAction(0,'AD_EXEC_VEICULO',A_EXECUTE,'Motorista',$ui->GetImageTheme('','icons/motorista.png'),'adm',$action, $this->oid, array("form"=>"motorista"));
		$panel3->InsertUserAction(0,'AD_EXEC_VEICULO',A_EXECUTE,'Veículo',$ui->GetImageTheme('','icons/veiculo.png'),'adm',$action, $this->oid, array("form"=>"veiculo"));
		$panel3->SetIconType('large');
		}
		}

	
        
       
}
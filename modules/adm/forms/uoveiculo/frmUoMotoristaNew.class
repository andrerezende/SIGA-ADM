<?
class frmUoMotoristaNew extends MForm
{
	function __construct()
	{
		parent::__construct('Associar Motorista');
		$this->EventHandler();
	}

	function CreateFields()
	{
            global $MIOLO;

		
			$fields = array(
                            new HiddenField('motorista', ''),
                            new MLookupFieldValue('lkpMotorista', '', 'Motorista', 50),
			);
                        $this->SetFields($fields);
                       
                        
                        $this->SetFieldAttr('lkpMotorista', 'module', 'adm');
			$this->SetFieldAttr('lkpMotorista', 'item', 'MotoristaUo1');
			$this->SetFieldAttr('lkpMotorista', 'event', 'filler');
			$this->SetFieldAttr('lkpMotorista', 'related', 'motorista,lkpMotorista');
		
			$this->SetValidators($validators);
			$buttons = array(
				new MButton('btnPost', 'Salvar'),
			);
			$this->SetButtons($buttons);
	}
        
        function btnPost_click(){            
            global $MIOLO;  
            $session = $MIOLO->getSession();
            $uoreqid = $session->getValue('uoreqid');
             $motorista = $this->manager->GetBusiness('adm','motorista');
             $idmotorista = $this->GetFormValue('motorista');
             
            
            $motorista->GetById($idmotorista);
            $motorista->iduo = $uoreqid;
            
            try
            {
                    $motorista->update();
                    $session->setValue('uoreqid', '');
                    $go = $this->manager->GetActionURL('adm','main:uoveiculo',$uoreqid);
                    $this->manager->Information('Motorista Associado a U.O.',$go);
            }
            catch (Exception $e)
            {
                    $this->addError($e->getMessage());
            } 
           
        }

}
?>

<?
/**
 * Form Veiculo
 */
class frmVeiculo1 extends CompoundForm
{
	public $oid;
    protected $veiculo;
    /**
     * Construtor
     */
    function __construct($objVeiculo)
    {
      global $MIOLO;
      $this->veiculo = $objVeiculo;
      parent::__construct();
      $this->SetClose($MIOLO->GetActionURL('adm','main:veiculo:find'));
      $this->SetTitle('Patrimonio');
      $this->SetIcon($MIOLO->GetUi()->GetImage('adm','default_mini.png'));
    }

    function CreateFields()
    {
        global $MIOLO, $page, $module, $context, $history,$item;

        $veiculo = $this->veiculo;
       
        $objItemPatrimonio = $this->manager->getBusiness('adm','itempatrimonio', $veiculo->idItemPatrimonio);            
        if ($this->oid == NULL) $this->oid = $veiculo->placa;

// form
        $ui = $MIOLO->GetUI();
        $form = Form::GetFormValue('form');
        switch ($form)
        {
            case 'editar' : 
				$this->_form[0] = $ui->GetForm($module,'frmVeiculoEditar', $veiculo, 'uoveiculo'); 
                break;
            case 'excluir'     : 
                 $this->_form[0] = $ui->GetForm($module,'frmVeiculoExcluir', $veiculo, 'uoveiculo'); 
                 break;
            case 'remover'     : 
                $session = $MIOLO->getSession();
                $itemUo = $session->getValue('itemuov');
                $veiculouo = $this->manager->getBusiness('adm','veiculouo');
                $veiculouo->GetById($item,$itemUo);
                $veiculouo->deleteVeiculouo($itemUo,$veiculo->placa);
                $go = $this->manager->GetActionURL('adm','main:uoveiculo',$itemUo);
                $MIOLO->Information("Veículo removido da U.O. com sucesso!.", $go);
                
                 //$this->_form[0] = $ui->GetForm($module,'frmVeiculoRemover', $veiculouo, 'uoveiculo'); 
                 break; 
            case 'editarCRLV'     : 
                 $this->_form[0] = $ui->GetForm($module,'frmVeiculoCrlvEditar', $veiculocrlv, 'uoveiculo'); 
                 break;
            case 'crlv'     : 
                 $this->_form[0] = $ui->GetForm($module,'frmVeiculoCrlvInserir', $veiculo, 'uoveiculo'); 
                 break; 
           case 'uo':
                if ( (($idu = $this->getFormValue('idu')) != NULL) && (($iduo = $this->getFormValue('iduo')) != NULL) ){
                       
		       $veiculo->DeleteUoVeiculo($idu, $veiculo->placa);
		}
				
                $this->_form[0] = $ui->GetForm($module,'frmVeiculoUoNew', $veiculo, 'veiculo'); 
                $page->SetAction($history->Top('action'));
                array_unshift($this->_form, $ui->GetGrid($module,'gridUoVeiculo', $veiculo));
                
                break;  
        }
        if ($this->_form[0])
        {
            $this->_form[0]->SetClose($MIOLO->GetActionURL('adm','main:veiculo',$uo->idVeiculo));
        	$page->SetAction($history->Top('action'));
        }
		
// info
	   $tabelaGeral = $this->manager->getBusiness('common','tabelageral');
	   $tabelaGeral2 = $this->manager->getBusiness('common','tabelageral');
           $instituicao = $this->manager->GetBusiness('common','instituicao');
           $tipoVeiculo = $tabelaGeral->getByItem('AD_TIPOVEICULO',$veiculo->tipoVeiculo);		 
           $tipoCombustivel = $tabelaGeral2->getByItem('AD_TIPOCOMBUSTIVEL', $veiculo->combustivel);
           $ui = $this->manager->getUi();
           $grid = $ui->GetGrid('adm','gridVeiculoCRLV');
		$this->_info[1]	= new TextLabel('iditemtx', $objItemPatrimonio->idItemPatrimonio, 'Id Patrimonio');	  
		$this->_info[2]	= new TextLabel('descricao', $objItemPatrimonio->descricao, 'Descrição');
		$this->_info[3]	= new TextLabel('marcaModelo', $objItemPatrimonio->marcaModelo, 'Marca/Modelo');
		$this->_info[4]	= new TextLabel('notaFiscal', $objItemPatrimonio->notafiscal, 'Nota Fiscal');
		$this->_info[5]	= new TextLabel('dataNotaFiscal', $objItemPatrimonio->dataNotaFiscal, 'Data da Nota');
		$this->_info[6]	= new TextLabel('dataAteste', $objNotaFiscal->dataAteste, 'Data de Ateste');
		$this->_info[7]	= new TextLabel('cnpj', $objItemPatrimonio->cnpj, 'CNPJ');
		$this->_info[8]	= new TextLabel('fornecedor', $objNotaFiscal->fornecedor, 'Fornecedor');
		$this->_info[9]	= new MSpacer(1);   	        
		$this->_info[10] = new MBox('Veículo');
		$this->_info[12] = new TextLabel('placa', $veiculo->placa,'Placa');
		$this->_info[13] = new TextLabel('tipoveiculo',$tipoVeiculo->item2,'Tipo de Veículo');                              				
		$this->_info[14] = new TextLabel('cor', $veiculo->cor, 'Cor');
		$this->_info[15] = new TextLabel('renavam', $veiculo->renavam,'Renavam');
		$this->_info[16] = new TextLabel('chassi',$veiculo->chassis,'Chassi');
		$this->_info[17] = new TextLabel('combustivel',$tipoCombustivel->item2,'Combustível');
		$this->_info[18] = new TextLabel('anoFab',$veiculo->anoFab,'Ano Fabricação');
		$this->_info[19] = new TextLabel('anoMod',$veiculo->anoMod,'Ano Modelo');
		$this->_info[20] = new MSpacer(1);
		$this->_info[21] = $grid;
		$this->_info[22] = new MSpacer(1);
//IFSP          
//Alterado em 02/02/2010
// 

$IdInstituicao = $this->veiculo->idinstituicao;

try
{
		$inst = $instituicao->GetById($IdInstituicao);
		$value = $inst->instituicao;
}
catch(Exception $e)
{
$value = '';
}				
//Alterado em 02/02/2010
//		$this->_info[12]= new TextLabel('idinstituicao',$value,'Instituição');   
//IFSP
// panel        
        $action = $context->action;
        $this->_panel[0] = $panel = new ActionPanel('pnlCompound','Opções','',false);
        $panel->AddUserAction('ADM_VEICULO',A_EXECUTE,'Editar',$ui->GetImage('adm','edit.png'),'adm',$action, $this->oid, array("form"=>"editar"));
        //$panel->AddUserAction('ADM_VEICULO',A_EXECUTE,'Excluir',$ui->GetImage('adm','excluir.png'),'adm',$action, $this->oid, array("form"=>"excluir"));
        $panel->AddUserAction('ADM_VEICULO',A_EXECUTE,'Inserir CRLV',$ui->GetImage('adm','biblioteca.png'),'adm',$action, $this->oid, array("form"=>"crlv"));
        $panel->AddUserAction('ADM_VEICULO',A_EXECUTE,'Desassociar da U.O.',$ui->GetImage('adm','excluir.png'),'adm',$action, $this->oid, array("form"=>"remover"));
        //$panel->AddUserAction('ADM_VEICULO',A_EXECUTE,'U.O.',$ui->GetImageTheme('','icons/uo.png'),'adm',$action, $this->oid, array("form"=>"uo"));
        
 	}
}
?>

<?php

class frmRepMapRequisicao extends Form {

    public function __construct() {

        parent::__construct('Requisições');
        $this->EventHandler();
        $this->defaultButton = false;
    }

    public function CreateFields() {
        global $MIOLO, $module, $action, $item, $theme;

        $opcoes2 = array(
                            "1"=>"PENDENTE",
                            "2"=>"SOLICITADA",
                            "4"=>"AUTORIZADA PELO GESTOR",
                            "5"=>"DEVOLVIDA PELO GESTOR",
                            "6"=>"RECUSADA UO REQ",
                            "7"=>"LIBERADA PARA EXECUCAO",
                            "J"=>"EM EXECUÇÃO",
                            "H"=>"ESTORNADA",
                            "G"=>"FINALIZADA",
            			    );    
        $fields = array(
            new TextField('idRequisicao','','Requisição',15),
	    //new Selection('status','','Status',$opcoes2)
        );
        
        

        $this->SetFields($fields);


        $buttons = array(
            new MButton('btnPost', 'Gerar Relatório'),
        );
        $this->SetButtons($buttons);
    }

    public function btnPost_click() {
        global $MIOLO, $module, $item;

        $report = new MJasperReport('sigaept');
        $parameters['SUBREPORT_DIR'] = $MIOLO->GetConf('home.modules');
        $parameters['pURL'] = $MIOLO->GetConf('home.url');
        $idRequisicao = $this->GetFormValue('idRequisicao');
        $objRequisicao = $this->manager->GetBusiness('adm', 'requisicao');
	$objRequisicao->GetById($idRequisicao);
        $status = $objRequisicao->status;

        $MIOLO->page->AddJsCode('window.open("http://'.$_SERVER['HTTP_HOST']
        . '/relatorios2/repMapRequisicao.php?idRequisicao=' . $idRequisicao . '&status=' . 
        $status . '");');


	}
 
}
?>
<?
global $MIOLO;
/**
 * Use Module C
 */
$MIOLO->Uses('controls/linkinspecao1.class','adm');

/**
 * Formulário básico para seleção de Unidadess
 * 
 */
class frmInspecaoFind extends Form
{
    public $id;
    public $uo;
    function __construct($uo)
    {
	global $MIOLO, $module;
        $this->uo = $uo;
        $this->Form('Inspeção de Veículo U.O');
	$this->SetClose($MIOLO->GetActionURL($module,'main:manutencao'));
        $this->EventHandler();
    }

    function CreateFields()
    {
        global $MIOLO, $action;

	$ui = $MIOLO->GetUI();
        
        $motorista = $this->manager->GetBusiness('adm','motorista');
        $veiculo = $this->manager->GetBusiness('adm','veiculo');
        $situacaoinspecao = $this->manager->GetBusiness('adm','situacaoinspecao');

	$result = $motorista->listMotorista($this->uo->idUo);
        $options = $result->chunkResult();
        $resultsituacao = $situacaoinspecao->ListAll();
        $optionssituacao = $resultsituacao->chunkResult();
        $resultveiculo = $veiculo->listVeiculo($this->uo->idUo);
        $optionsveiculo = $resultveiculo->chunkResult();
        
        
        $session = $MIOLO->getSession();
	$session->set('idUo',$this->uo->idUo);

        
        $lnkNew = new LinkInspecao1('lnkNew', FALSE,$this->uo);
        $lnkNew->setNew();
        new MSpacer(2);
        new MPanel('painelGestor', 'Dados do Gestor');
        $findButton = new ButtonFind('');
        $findButton->SetName('btnFind');
        new MSpacer(2);
        new MPanel('painelGestor', 'Dados do Gestor');
                
        $controls1 = array(
            new MSelection('veiculo','','Veículo:',$optionsveiculo),
            new FormButton('btnPost1','Enviar')
			);
        $controlGroup1 = new BaseGroup('controlGroup2','Listar por veículo',$controls1,'horizontal','css');
        
        $controls2 = array(
            new Text('','De'),
	    new CalendarField('datainicio', '', '', '10', 'Ex.: 01/01/2001'),
            new Text('',' a :'),
            new CalendarField('datasaida', '', '', '10', 'Ex.: 01/01/2001'), 
            new FormButton('btnPost2','Enviar')
			);
        $controlGroup2 = new BaseGroup('controlGroup2','Listar por período',$controls2,'horizontal','css');
        
        $controls3 = array(
            new MSelection('motorista','','Motorista:',$options),
            new FormButton('btnPost3','Enviar')
			);
        $controlGroup3 = new BaseGroup('controlGroup2','Listar por motorista',$controls3,'horizontal','css');
        
        $controls4 = array(
            new MSelection('situacao','','Situação:',$optionssituacao),
            new FormButton('btnPost4','Enviar'),
			);
        $controlGroup4 = new BaseGroup('controlGroup2','Listar por situação',$controls4,'horizontal','css');
        
        $grid = $ui->GetGrid('adm','gridInspecao1');
        $grid->SetTitle(NULL);
        
        $fields = array(
            array(
                $controlGroup1,
                $controlGroup3,
                $controlGroup4,
                $controlGroup2,
                
            ),
            $lnkNew,
            new MSpacer(1),
            new MPanel('painelGestor', 'Resultado da Busca'),
            $grid
        );
        
        
        $this->SetFields($fields);
        $this->defaultButton = false;
    }
 }
?>

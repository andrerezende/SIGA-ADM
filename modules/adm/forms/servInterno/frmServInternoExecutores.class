<?
class frmServInternoExecutores extends Form
{
	protected $objTipoServInterno;
	
    function __construct($objTipoServInterno)
    {
        global $MIOLO, $module, $self, $page;
        
		$this->objTipoServInterno = $objTipoServInterno;
        
        //$urlBase = $MIOLO->getActionUrl($module,'main:uo',$this->objTipoServInterno->idUo,array('form'=>'gestor'));
        //$page->setAction($urlBase);
        
        $this->Form('Incluir');
        $this->EventHandler();
    }

    function CreateFields()
    {
		$fields = array(
			new MLookupTextField('lkpUsuario','','Login',20),
			new MTextField('nome','','Nome',50),
            new MCalendarField('dataInicio','','Data Inicio',15),
            new MCalendarField('dataFim','','Data Fim',15),
			new MHiddenField('idUsuario','')
        );
		
        $this->SetFields($fields);

        $validators = array(
            new MDateDMYValidator('dataInicio','','required'),
            new MDateDMYValidator('dataFim','','required')
        );
        
        $this->SetValidators($validators);
		
        $this->SetFieldAttr('lkpUsuario','module','common');
	    $this->SetFieldAttr('lkpUsuario','item','usuario');
	    $this->SetFieldAttr('lkpUsuario','event','filler');
	    $this->SetFieldAttr('lkpUsuario','related','idUsuario,lkpUsuario,NULL,NULL,NULL,NULL,nome');
		
		$buttons = array(
        	new FormButton('btnSalvar', 'Incluir')
        );

		$this->SetButtons($buttons);
    }

	public function btnSalvar_click()
	{
		$data = $this->getData();
		$executor = $this->manager->getBusiness('adm','executorservint');
        $executor->setData($data);
        //var_dump($executor);
        $executor->idTipoServInt = $this->objTipoServInterno->idTipoServInt;
        
        //var_dump($this->idUsuario);
        
		if (!$data->idUsuario) $this->addInfo('Usuário inexistente.');
        else
        {
            try
            {
                $executor->save();
                $this->manager->Information('Executor adicionado com sucesso.');
            }
            catch (Exception $e)
            {
                $this->manager->Error("Informe o seguinte erro à equipe do CGCO: ",$e->getMessage());
            }        
        }
	}
 }
?>

<?
class frmRubricaEditar extends MForm
{

    protected $objRubrica;
	
    function __construct($objRubrica)
    {
        $this->objRubrica = $objRubrica;
        //$this->Form('Dados da Rubrica');
	parent::__construct('Dados da Rubrica');
        $this->EventHandler();
    }

    function CreateFields()
    {
        global $MIOLO;
        $fields = array	(
	    new MTextField('idRubrica','','Código','20'),
            new MTextField('descricao','','Descrição','70'),
        );
		
        $this->SetFields($fields);
		
        $buttons = array (
           new FormButton('btnSalvar', 'Salvar')
        );
        $this->SetButtons($buttons);

        $validators = array (
            new MRequiredValidator('idRubrica'),
            new MRequiredValidator('descricao'),
        );
	$this->setFieldAttr('idRubrica','readonly',True);
        $this->SetValidators($validators);
        $this->SetData();
    }

    function SetData()
    {
        $data = $this->objRubrica;
	$this->SetFieldValue('idRubrica',$data->idRubrica);
	$this->SetFieldValue('descricao',strtoupper($data->descricao));
    }
	
    public function btnSalvar_click()
    {
        $this->objRubrica->SetData($this->GetData());
        try
        {
            $this->objRubrica->save();
            $this->objRubrica->Log(OP_UPD,"Dados de rubrica modificados");
	    $go = $this->manager->GetActionURL('adm','main:rubrica',$this->objRubrica->idRubrica);
	    $this->manager->Information('Rubrica alterada com sucesso', $go);
        }
        catch (Exception $e)
        {
            $this->addError($e->getMessage());
        }
    }
}
?>

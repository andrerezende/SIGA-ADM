<?php

class frmRepMapUtilizacaoMotorista extends Form {

    public function __construct() {

        parent::__construct('Mapa de Utilização de Motorista');
        $this->EventHandler();
        $this->defaultButton = false;
    }

    public function CreateFields() {
        global $MIOLO, $module, $action, $item, $theme;


        $fields = array(
            new HiddenField('idMotorista', ''),
            new MLookupFieldValue('lkpMotorista', '', 'Motorista', 50),
            new MCalendarField('datainicio', '', 'A partir de', 27)
        );
        
        

        $this->SetFields($fields);
        
        $this->SetFieldAttr('lkpMotorista', 'module', 'adm');
	$this->SetFieldAttr('lkpMotorista', 'item', 'MotoristaUo');
	$this->SetFieldAttr('lkpMotorista', 'event', 'filler');
	$this->SetFieldAttr('lkpMotorista', 'related', 'idMotorista,lkpMotorista');


        $buttons = array(
            new MButton('btnPost', 'Gerar Relatório'),
        );
        $this->SetButtons($buttons);
    }

    public function btnPost_click() {
        global $MIOLO, $module, $item;

        $report = new MJasperReport('sigaept');
        $parameters['SUBREPORT_DIR'] = $MIOLO->GetConf('home.modules');
        $parameters['pURL'] = $MIOLO->GetConf('home.url');
        $idMotorista = $this->GetFormValue('idMotorista');
        $datainicio = $this->GetFormValue('datainicio');

        $MIOLO->page->AddJsCode('window.open("http://'.$_SERVER['HTTP_HOST']
        . '/relatorios2/repMapUtilizacaoMotorista.php?idMotorista=' . $idMotorista . '&datainicio=' . 
        $datainicio . '");');


	}
 
}
?>
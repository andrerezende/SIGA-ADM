<?
/*
 * Formulário de Edição de Itinerário
 *
 * Autor		: Phillip Pena Parente
 * Data		: 13/07/2012
 * Problema:
 *
*/
class frmItinerarioEdit extends MForm {

		protected $objRequisicao;

		function __construct($objRequisicao) {

				$this->objRequisicao = $objRequisicao;
				parent::__construct('Editar Itinerario');
				$this->eventHandler();
		}

		function CreateFields() {
				global $MIOLO;

				//Pegando as variáveis de Requisição e Ordem da URL
				$requisicao = $_GET['item'];
				$ordem = $_GET['ordem'];

				//Declarando Objeto de Itinerário
				$objItinerario = $MIOLO->getBusiness('adm', 'itinerario');
				$objItinerario = $objItinerario->GetByRequisicaoOrdem($requisicao, $ordem);


				//Declarando Objetos  de Endereço
				$objEnderecoOrigem = $MIOLO->getBusiness('adm', 'endereco');
				$objEnderecoOrigem = $objEnderecoOrigem->GetById($objItinerario->idEnderecoOrigem);
				$objEnderecoDestino = $MIOLO->getBusiness('adm', 'endereco');
				$objEnderecoDestino = $objEnderecoDestino->GetById($objItinerario->idEnderecoDestino);

				//Formatando a Data
				$arrayDataHora=  explode(" ", $objItinerario->datasaida);
				$arrayDataHora[0]= explode('-', $arrayDataHora[0]);
				$arrayDataHora[0]=$arrayDataHora[0][2]."/".$arrayDataHora[0][1]."/".$arrayDataHora[0][0];

				//Adicionando os Labels que ficarão em 'readonly'
				$this->AddField(new MTextField('labelRequisicao', $objItinerario->idRequisicao, 'Requisicão'));
				$this->AddField(new MTextField('labelOrdem', $objItinerario->ordem, 'Ordem'));

				//Atribuindo aos Labels o atributo de ReadOnly
				$this->SetFieldAttr('labelRequisicao', 'readonly', TRUE);
				$this->SetFieldAttr('labelOrdem', 'readonly', TRUE);

				//Adicionando Espaço
				$this->AddField(new MSpacer(1));

				//Adicionando Lookup de Endereço Origem
				$lkpLocalOrigem = new MLookupTextField('origem', $objEnderecoOrigem->nomelocal, 'Origem', 50);
				$this->AddField(new MHiddenField('idOrigem', $objItinerario->idEnderecoOrigem));
				$this->AddField(new MHiddenField('idDestino', $objItinerario->idEnderecoDestino));
				$lkpLocalOrigem->module = 'adm';
				$lkpLocalOrigem->item = 'endereco';
				$lkpLocalOrigem->event = 'filler';
				$lkpLocalOrigem->related = 'idOrigem,origem';
				$lkpLocalOrigem->autocomplete =true;

				//Adicionando Lookup de Endereço Destino
				$lkpLocalDestino = new MLookupTextField('destino', $objEnderecoDestino->nomelocal, 'Destino', 50);
				$lkpLocalDestino->module = 'adm';
				$lkpLocalDestino->item = 'endereco';
				$lkpLocalDestino->event = 'filler';
				$lkpLocalDestino->related = 'idDestino,destino';
				$lkpLocalDestino->autocomplete=true;

				//Declarando os Campos de Data e Hora de Saída
				$dataSaida = new CalendarField('dataSaida', $arrayDataHora[0], 'Data de Saída', 10, 'Ex: 01/01/2001');
				$horaSaida = new MTextField('horaSaida', $arrayDataHora[1], 'Hora de Saída', 5, 'Ex: 12:50');

				//Adicionando Máscaras aos campos
				$this->page->AddJsCode(file_get_contents(dirname(__FILE__) . '/../../ui/js/mask.js'));
				$horaSaida->AddAttribute('onBlur', 'makeMask(this, \'##:##\');');
				$horaSaida->AddAttribute('onKeyUp', 'makeMask(this, \'##:##\');');
				$horaSaida->AddAttribute('maxlength', '5');

				//Adicionando os Campos de Edição
				$this->AddField($lkpLocalOrigem);
				$this->AddField($lkpLocalDestino);
				$this->AddField($dataSaida);
				$this->AddField($horaSaida);

				$this->AddButton(new MButton('btnAtualizar', 'Atualizar'));
				$this->AddButton(new MButton('btnExcluir', 'Excluir'));



		}



}

?>

<?
class frmRepFechamento extends Form
{
	var $objTipoReq;
   
   function __construct()
   {
 	  global $MIOLO, $module, $self;
 	  $this->Form('Relatorio de Fechamento');
 	  $this->EventHandler();
   }

	function CreateFields()
	{
		global $MIOLO,$module,$self, $action, $auth;
			
		$fields = array(
			new CalendarField('dataInicio','','A partir de'),
            new CalendarField('dataFim','','Até'), 
		);
		$this->SetFields($fields);

		$buttons = array(
			new FormButton('btnJasper', 'Gerar Relatório', 'PDF')
		);
		$this->SetButtons($buttons);
	}

   function btnJasper_click()
   {
        global $MIOLO;
	$report = new MJasperReport('sigaept');
	$inverteData = new MKrono();
	$parameters['DATAINI'] = $inverteData->invertDate(Form::getFormValue('dataInicio'));		
	$parameters['DATAFIM'] = $inverteData->invertDate(Form::getFormValue('dataFim'));	
	$parameters['LOGO'] = $MIOLO->GetConf('home.url');
	//$parameters['NOME_INSTITUICAO'] = $MIOLO->GetConf('instituicao.nome');	
	$parameters['SUBREPORT_DIR'] = $MIOLO->GetConf('home.modules').'/common/reports/';
	$parameters['ID_USUARIO'] = $MIOLO->login->idkey;
	$report->Execute('adm', 'RelatorioDeFechamento', $parameters);
   }
}
?>

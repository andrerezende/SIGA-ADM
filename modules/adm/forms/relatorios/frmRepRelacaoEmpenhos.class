<?
class frmRepRelacaoEmpenhos extends MForm
{
	function __construct()
    {
	parent::__construct('Relação de Empenhos');
		//$this->SetClose($this->manager->GetActionURL('adm','main:relatorios'));
        $this->EventHandler();
		$this->defaultButton = false;
    }

  /*  function CreateFields()

    {

               global $MIOLO, $module, $action, $item, $theme;

		//$options = array('1'=>'Todos','2'=>'Apenas com Saldo');
		$fields = array(
			//new MTextField('empenho', '', 'Empenho', 20),
			//new MTextField('licitacao', '', 'Licitação', 20),
			new MCalendarField('calDataInicial','','Data Inicial'),
			new MCalendarField('calDataFinal','','Data Final'),
			//new MLookupTextField('fornecedor', '', 'Fornecedor', 60),
			//new MTextField('rubrica', '', 'Rubrica', 20),
			//new Selection('saldo','','Saldo'),
			//new MHiddenField('idFornecedor'),
		);
         	$this->SetFields($fields);
		/*$this->SetFieldAttr('saldo','options',$options);
		$this->SetFieldAttr('fornecedor','module','adm');
		$this->SetFieldAttr('fornecedor','item','fornecedor');
		$this->SetFieldAttr('fornecedor','event','filler');
		$this->SetFieldAttr('fornecedor','related', 'idFornecedor,fornecedor');

		$buttons = array(
			new MButton('btnPost','Gerar Relatório','PDF'),
		);
       	$this->SetButtons($buttons);
	}

*/



	function CreateFields()
    {
		global $MIOLO, $module, $action, $item, $theme;

		$fields = array(
			new MCalendarField('dataInicial','','A partir de',20),
			new MCalendarField('dataFinal','','Até',20),
		);
		$this->SetFields($fields);

		$buttons = array(
			new MButton('btnPost','Gerar Relatório','PDF'),
		);
		$this->SetButtons($buttons);
	}


 function btnPost_click()
    {	
		global $MIOLO, $module, $item;

		$ui = $MIOLO->GetUI();

		global $MIOLO, $module, $item;

        	$report = new MJasperReport('sigaept'); 
       	 	$parameters['SUBREPORT_DIR']	= $MIOLO->GetConf('home.modules');
        	$parameters['int_pIdUsuario']	= $MIOLO->login->idkey;
       		$parameters['pURL']		= $MIOLO->GetConf('home.url');
    
 	$date = Form::GetFormValue('dataInicial'); 
	$token = explode("/",$date);
	$date = $token[2]."/".$token[1]."/".$token[0];
	$parameters['pDataIni'] = $date;

	$date = Form::GetFormValue('dataFinal'); 
	$token = explode("/",$date);
	$date = $token[2]."/".$token[1]."/".$token[0];
	$parameters['pDataFim'] = $date;

	

/*
        $report = new MJasperReport('sigaept'); 
        $parameters['pDataIni'] 	= Form::GetFormValue('calDataInicial'); 
        $parameters['pDataFim']	        = Form::GetFormValue('calDataFinal'); 
        $parameters['SUBREPORT_DIR']	= $MIOLO->GetConf('home.modules');
        $parameters['int_pIdUsuario']	= $MIOLO->login->idkey;
        $parameters['pURL']		= $MIOLO->GetConf('home.url');*/

//var_dump($parameters);

        $report->Execute('adm', 'repRelacaoEmpenhos', $parameters);



    }
}
?>

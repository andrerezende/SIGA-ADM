<?
class frmRepRequisicoesDevolvidas extends Form
{
	function __construct()
    {
		global $MIOLO;
        $this->Form('Relatório de Requisições Devolvidas');
		$this->SetClose($this->manager->GetActionURL('adm','main:relatorios'));
        $this->EventHandler();
    }

    function CreateFields()
    {
		global $MIOLO, $module;

		$fields = array(
			new CalendarField('calDataInicial','','Data Inicial'),
			new CalendarField('calDataFinal','','Data Final'),
		);
       	$this->SetFields($fields);

		$button = array(
			new FormButton('btnRelatorio','Gerar Relatório','PDF'),
		);
       	$this->SetButtons($button);
		$this->defaultButton = false;
	}

	function btnRelatorio_click()
	{
		global $MIOLO;

		$inicio = $this->getFieldValue('calDataInicial');
		$inicio = substr($inicio,6,4).'/'.substr($inicio,3,2).'/'.substr($inicio,0,2);
		$final = $this->getFieldValue('calDataFinal');
		$final = substr($final,6,4).'/'.substr($final,3,2).'/'.substr($final,0,2);
		$report = new MJasperReport('sigaept');
		$parameters['SUBREPORT_DIR'] = $this->manager->getModulePath('adm', 'reports/');
		$parameters['str_DATAINICIAL'] = $inicio;
		$parameters['str_DATAFINAL'] = $final;
		$report->Execute('adm', 'RequisicoesDevolvidas', $parameters);
	}
}
?>

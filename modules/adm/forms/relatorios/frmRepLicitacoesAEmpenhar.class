<?
class frmRepLicitacoesAEmpenhar extends MForm
{
    function __construct()
    {
        parent::__construct('Relatório de Licitações A Empenhar');
        $this->EventHandler();
		$this->defaultButton = false;
    }

	function CreateFields()
    {
		global $MIOLO, $module;

		$uo = $MIOLO->GetBusiness($module,'uo');
		$opt = $uo->listUosOrdemNome();
		//$options['0'] = 'TODAS';
		foreach($opt->result as $o)
		{
			$options[$o[0]] = $o[1];
		}

		$fields = array(
			new Selection('selUO','','UO',$options),
			new CalendarField('calDataInicial','','Data Inicial'),
			new CalendarField('calDataFinal','','Data Final'),
		);
		$this->SetFields($fields);

		$button = array(
			new FormButton('btnPost','Gerar Relatório','PDF'),
		);
		$this->SetButtons($button);
		$this->defaultButton = false;
	}

    function btnPost_click()
    {
		global $MIOLO, $module, $item;

		$report = new MJasperReport('sigaept');

		$parameters['int_idUo'] 	= Form::GetFormValue('selUO');
		$parameters['dataInic'] 	= Form::GetFormValue('calDataInicial');
		$parameters['dataFim'] 		= Form::GetFormValue('calDataFinal'); 
       	$parameters['SUBREPORT_DIR']	= $MIOLO->GetConf('home.modules');
       	$parameters['int_pIdUsuario']	= $MIOLO->login->idkey;
       	$parameters['pURL']		= $MIOLO->GetConf('home.url');
      
       	$report->Execute('adm', 'repLicitacoesAEmpenhar', $parameters);
	}
}
?>

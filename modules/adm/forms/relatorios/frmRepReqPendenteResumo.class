<?
class frmRepReqPendenteResumo extends Form
{
	var $objTipoReq;
   
   function __construct()
   {
 	  global $MIOLO, $module, $self;
 	  $this->Form('Resumo de Requisições Pendentes');
 	  $this->EventHandler();
   }

	function CreateFields()
	{
		global $MIOLO,$module,$self, $action, $auth;

		$this->objTipoReq = $MIOLO->GetBusiness($module,'tiporeq');		
		$lista = $this->objTipoReq->ListAll();		    	    

		for ($i=0; $i<count($lista->result); $i++){
			if (($lista->result[$i][1] <> 'ALMOXARIFADO') && ($lista->result[$i][1] <> 'COMPRA')
						&& ($lista->result[$i][1] <> 'SERVICO EXTERNO'))
			{			
				$options[$lista->result[$i][0]] = $lista->result[$i][1];
			}
		}	
			
		
		$fields = array(
			new MSelection('selTipoRequisicao','','Tipos de Requisição',$options,false),
			new CalendarField('dataInicio','','A partir de'),
            new CalendarField('dataFim','','Até'),
           
		);
		$this->SetFields($fields);

		$buttons = array(
			new FormButton('btnPost', 'Gerar Relatório', 'PDF')
		);
		$this->SetButtons($buttons);
	}

   function btnPost_click()
   {
		 /*global $MIOLO, $module;
	
		 $ui = $MIOLO->GetUI();
	     $report = $ui->GetReport($module,'repRequisicaoPendenteResumo');
	     $report->Generate();*/
   	
   		global $MIOLO, $module, $item;

		$report = new MJasperReport('sigaept');

		$parameters['int_tipoReq'] 	= Form::GetFormValue('selTipoRequisicao');
		$parameters['dataInic'] 	= Form::GetFormValue('dataInicio');
		$parameters['dataFim'] 		= Form::GetFormValue('dataFim'); 
       	$parameters['SUBREPORT_DIR']	= $MIOLO->GetConf('home.modules');
       	$parameters['int_pIdUsuario']	= $MIOLO->login->idkey;
       	$parameters['pURL']		= $MIOLO->GetConf('home.url');
      
       	$report->Execute('adm', 'reqPendentesResumo', $parameters);
   }   
}
?>
<?
class frmRepItensPatrimonio extends MCompoundForm
{
    
    
    function __construct()
    {
        global $MIOLO;
        
        parent::__construct();
        $this->SetClose($MIOLO->GetActionURL('adm', 'main:patrimonio'));
        $this->SetTitle(null);
        $this->SetIcon($MIOLO->GetUi()->GetImage('adm','default_mini.png'));
        $this->EventHandler();
        $this->defaultButton = false;
        
    }

	function CreateFields()
    {
		//global $MIOLO, $module, $action, $item, $theme;
                global $MIOLO, $page, $module, $context, $history, $perms, $action;
                
/*                
//FILTRO POR INSTITUIÇÃO OU SETOR
        $opFiltro = array('I'=>'Instituição','S'=>'Setor');
        $opt1 = new MOption( 'opt1', $opFiltro['I'],$opFiltro['I'].'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', FALSE, 'id1' );
        $opt2 = new MOption( 'opt2', $opFiltro['S'],$opFiltro['S'].'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', false, 'id2' );
        $this->RbFiltro = new MRadioButtonGroup('filtro','',array($opt1,$opt2),false,'','horizontal','none');
        $this->RbFiltro->addAttribute('style','padding:10px');
        //$opt1->setEnabled(true);
        //$this->RbFiltro->addAttribute("onchange","doTextTipo('$url');");
        //$tipo->addAttribute("onchange","doTextTipo('$url');");
        
 * 
 */
        
        $ui = $MIOLO->GetUI();
		$form = MForm::GetFormValue('form');
		if ($form == 'instituicao') {
			$this->_form[0] = $ui->GetForm($module,'frmRepItensPatrimonio_Instituicao','', 'patrimonio');
		} else if ($form == 'setor'){
			$this->_form[0] = $ui->GetForm($module,'frmRepItensPatrimonio_Setor', '', 'patrimonio');
		} else if ($form == 'contaContabil'){
			$this->_form[0] = $ui->GetForm($module,'frmRepItensPatrimonio_ContaContabil', '', 'patrimonio');
		} else if ($form == 'empenho'){
			$this->_form[0] = $ui->GetForm($module,'frmRepItensPatrimonio_Empenho', '', 'patrimonio');
		} else if ($form == 'cnpj'){
			$this->_form[0] = $ui->GetForm($module,'frmRepItensPatrimonio_cnpj', '', 'patrimonio');
		} 
                
		if ($this->_form[0]) {
			$this->_form[0]->SetClose($MIOLO->GetActionURL('adm','main:patrimonio'));
			$page->SetAction($history->Top('action'));
		}
                
                
                $this->_panel[0] = $panel = new ActionPanel('pnlCompound','Relatório de Itens Patrimoniais','',null);
                
                $panel->AddAction(
                    'Relatório de Itens Patrimoniais',
                    $ui->GetImageTheme('','icons/relatorio.png'),
                    $module,
                    $action,
                    $this->oid,
                    array('form' => 'instituicao')
                );
                
                $panel->AddAction(
                    'Por Setor',
                    $ui->GetImageTheme('','icons/relatorio.png'),
                    $module,
                    $action,
                    $this->oid,
                    array('form' => 'setor')
                );
                
                $panel->AddAction(
                    'Por Conta Contábil',
                    $ui->GetImageTheme('','icons/relatorio.png'),
                    $module,
                    $action,
                    $this->oid,
                    array('form' => 'contaContabil')
                );
                
                $panel->AddAction(
                    'Por Empenho',
                    $ui->GetImageTheme('','icons/relatorio.png'),
                    $module,
                    $action,
                    $this->oid,
                    array('form' => 'empenho')
                );
                
                $panel->AddAction(
                    'Por CNPJ',
                    $ui->GetImageTheme('','icons/relatorio.png'),
                    $module,
                    $action,
                    $this->oid,
                    array('form' => 'cnpj')
                );
                
                
                
                
                
                
                
                
                
                
                
                /* // Conteudo dos forms

                $orderby = Form::GetFormValue('orderby');
                $opcoes = array(
                                 "i.iditempatrimonio"=>"Nº Tombo",
                                 "i.descricao"=>"Descrição",                                
                                );
		$fields = array(
                    $this->RbFiltro,
                    // 06/06/2011 Daniel Bonfim **
                    new MLookupTextField('instituicao', '', 'Instituição', 30, NULL, NULL, NULL, 'common', 'instituicao2'),
                    //$lkInstituicao,
                    new MLookupTextField('siglaSetor', '', 'Setor', 10, NULL, NULL, NULL, 'common', 'setor2'),                    
                    //new MLookupTextField('siglaSetor', $lkInstituicao->getValue(), 'Setor', 10, NULL, NULL, NULL, 'common', 'setor2'),
                                      
                    
                    new MLookupTextField('idVidaUtil', '', 'Conta Contábil', 10, NULL, NULL, NULL, 'adm', 'VidaUtil'),
                    new MHiddenField('idSetor'),
                    new MHiddenField('idInstituicao'),
                    //$idInstituicao,
                    //new MHiddenField('siglaInstit'),  
                    //new MHiddenField('setor'),  
                    //new MHiddenField('vidautil'),
                    
                    new MSelection('orderby', $orderby,'Ordenar por', $opcoes)
		);  
		$this->SetFields($fields);
                $this->SetFieldAttr('instituicao', 'related', 'idInstituicao,instituicao');
                //$this->SetFieldAttr('instituicao', 'related', 'siglaSetor,instituicao');
                $this->SetFieldAttr('siglaSetor', 'related', 'idSetor,siglaSetor'); 
                $this->SetFieldAttr('idVidaUtil', 'related', 'idVidaUtil');
                

                   // **
                
		$buttons = array(
			new MButton('btnPost','Gerar Relatório','PDF'),
                        new MButton('btnLimpar','Limpar'),
		);
		$this->SetButtons($buttons);
                 * 
                 */
	}
        /*
        
        function btnLimpar_click() {
            
            $this->SetFieldValue('instituicao', "");
            $this->SetFieldValue('siglaSetor', "");
            $this->SetFieldValue('idVidaUtil', "");
        }
        

    function btnPost_click()
    {        
	global $MIOLO, $module, $item, $theme;
        
        
        $report = new MJasperReport('sigaept');
        $parameters['SUBREPORT_DIR']	= $MIOLO->GetConf('home.modules');
        $parameters['int_pIdUsuario']	= $MIOLO->login->idkey;
        $parameters['pOrdem']	=  Form::GetFormValue('orderby');
        $parameters['pData'] = date('d/m/y');
        
        // 06/06/2011 - Daniel Bonfim   
        
        $parameters['pIdInstituicao']	=  '%';
        $parameters['pIdSetor']         =  '%';      
        $parameters['pIdVidaUtil']	=  '%';
        
        
        
        if($this->RbFiltro->getValue() == 'Instituição') {
            $parameters['pIdSetor'] = '%';
            if(Form::GetFormValue('instituicao') != "") {
                $parameters['pIdInstituicao']	=  Form::GetFormValue('idInstituicao');
            } else {
                $this->AddError("Ĩnforme a instituição para a pesquisa.");
                return;
            }
        } else 
            if($this->RbFiltro->getValue() == 'Setor') {
                $parameters['pIdInstituicao'] = '%';
                if(Form::GetFormValue('idSetor') != "") {
                    $parameters['pIdSetor']	=  Form::GetFormValue('idSetor');
                } else {
                    $this->AddError("Ĩnforme o setor para a pesquisa.");
                    return;
                }
        } else {
            $this->AddError("Selecione um dos filtros para o relatório.");
            return;
        }
        
  
        if(Form::GetFormValue('idVidaUtil') != "") {
            $parameters['pIdVidaUtil']	=  Form::GetFormValue('idVidaUtil');
        } else {
            $parameters['pIdVidaUtil'] = '%';
            
        }
        
        
        
        $parameters['pURL']		= $MIOLO->GetConf('home.url');
        if(!empty($parameters['pOrdem']) && !is_null($parameters['pOrdem'])) {
            ($parameters['pOrdem'] == "i.iditempatrimonio") ? $report->Execute($module, 'itensPatrimonio2', $parameters) : $report->Execute($module, 'itensPatrimonio', $parameters);
        
        } else {
            $this->Error("Selecione o tipo de ordenação");
            return;
        }
        //var_dump($parameters['pOrdem'] == "i.iditempatrimonio");exit;
         //$setores = ($this->perms->checkAccess('PROT_ADMIN', A_ACCESS)) ? $this->setor->selAll() : $this->setoracesso->selSetoresAcesso($this->processo->getSetorUsuario());
        
        }
   // }
         * 
         */

    
}
?>

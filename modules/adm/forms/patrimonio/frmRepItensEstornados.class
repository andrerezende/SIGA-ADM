<?php

// 19/10/2010 - Vitor Pacheco
class frmRepItensEstornados extends MForm {

    public function __construct() {

        parent::__construct('Relatório de Itens Estornados');
        $this->EventHandler();
        $this->defaultButton = false;
    }

    public function CreateFields() {
        global $MIOLO, $module, $action, $item, $theme;


        $fields = array(
            $notafiscal = new MLookupTextField('notafiscal', '', 'Nº da Nota Fiscal', 27, NULL, NULL, NULL, 'adm', 'notafiscal3'),
            new MTextField('descricao', '', 'Descrição do Item', 27, NULL, NULL, false),
            new MSeparator('Período de aquisição'),
            new MCalendarField('datainicio', '', 'A partir de', 27),
            new MCalendarField('datafim', '', 'Até', 27)
        );

        $this->SetFields($fields);


        $this->SetFieldAttr('notafiscal', 'related', 'notafiscal');


        $buttons = array(
            new MButton('btnPost', 'Gerar Relatório'),
        );
        $this->SetButtons($buttons);
    }

    public function btnPost_click() {
        global $MIOLO, $module, $item;

        $report = new MJasperReport('sigaept');
        $parameters['SUBREPORT_DIR'] = $MIOLO->GetConf('home.modules');
        $parameters['pURL'] = $MIOLO->GetConf('home.url');
        $notafiscal = $this->GetFormValue('notafiscal');
        $descricao = $this->GetFormValue('descricao');
        $datainicio = $this->GetFormValue('datainicio');
        $datafim = $this->GetFormValue('datafim');
        $ativo = "N";

        $MIOLO->page->AddJsCode('window.open("http://'.$_SERVER['HTTP_HOST']
        . '/relatorios2/repItensEstornados.php?notafiscal=' . $notafiscal . '&descricao=' . $descricao . '&datainicio=' . 
        $datainicio . '&datafim=' . $datafim.'&ativo='.$ativo.'");');


	}
 
}
?>
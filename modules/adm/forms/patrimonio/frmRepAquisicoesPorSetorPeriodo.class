<?
class frmRepAquisicoesPorSetorPeriodo extends MForm
{
    function __construct()
    {
        parent::__construct('Relatório de Aquisições por Setor no Período');
        $this->EventHandler();
		$this->defaultButton = false;
    }

	function CreateFields()
    {
		global $MIOLO, $module, $action, $item, $theme;

		$fields = array(
			new MLookupTextField('setor','','Setor',20),
			new MCalendarField('dataInicial','','A partir de',20),
			new MCalendarField('dataFinal','','Até',20),
			new MHiddenField('idSetor'),
		);
		$this->SetFields($fields);
		$this->SetFieldAttr('setor','module','common');
		$this->SetFieldAttr('setor','item','setor');
		$this->SetFieldAttr('setor','related', 'idSetor,setor');

		$buttons = array(
			new MButton('btnPost','Gerar Relatório','PDF'),
		);
		$this->SetButtons($buttons);
	}

  function btnPost_click()
    {
	global $MIOLO, $module, $item;

        $report = new MJasperReport('sigaept'); 
        $parameters['SUBREPORT_DIR']	= $MIOLO->GetConf('home.modules');
        $parameters['int_pIdUsuario']	= $MIOLO->login->idkey;
        $parameters['pURL']		= $MIOLO->GetConf('home.url');
        $parameters['pDataIni'] 	= Form::GetFormValue('dataInicial'); 
        $parameters['pDataFim']	        = Form::GetFormValue('dataFinal'); 
        $parameters['int_pSetor']	= Form::GetFormValue('idSetor'); 

 	/*$date = Form::GetFormValue('dataInicial'); 
	$token = explode("/",$date);
	$date = $token[2]."/".$token[1]."/".$token[0];
	$parameters['pDataIni'] = $date;

	$date = Form::GetFormValue('dataFinal'); 
	$token = explode("/",$date);
	$date = $token[2]."/".$token[1]."/".$token[0];
	$parameters['pDataFim'] = $date;*/


     //var_dump($parameters);
        $report->Execute($module, 'repAquisicoesSetorPorPeriodo', $parameters);
	}
}
?>

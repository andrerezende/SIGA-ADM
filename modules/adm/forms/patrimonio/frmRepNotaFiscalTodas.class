<?php
class frmRepNotaFiscalTodas extends MForm {
    function __construct() {
        parent::__construct('Relatório de Notas Fiscais');
        $this->EventHandler();
		$this->defaultButton = false;
    }

	function CreateFields() {
		global $MIOLO, $module, $action, $item, $theme;

        $orderby = Form::GetFormValue('orderby');
        $opcoes = array(
            "numeroNota" => "Número da Nota Fiscal",
            "data" => "Data de Emissão",
            "valor" => "Valor Total"                           
        );

		$fields = array(
			new MSelection('orderby', $orderby,'Ordenar por', $opcoes)
		);  

		$this->SetFields($fields);

		$buttons = array(
			new MButton('btnPost','Gerar Relatório','PDF'),
		);
		$this->SetButtons($buttons);
	}

    function btnPost_click() {
        global $MIOLO, $module, $item;

        $report = new MJasperReport('sigaept');
        $parameters['pURL'] = $MIOLO->GetConf('home.url');
        $parameters['pIdUsuario'] = $MIOLO->login->idkey;
        $parameters['pOrdem'] = Form::GetFormValue('orderby');
        // caso pOrdem seja por numero ele gera repNotaFiscalTodas3, caso por data ele gera o relatorio repNotaFiscalTodas, caso por valor ele gera repNotaFiscalTodas2 
        // o envio do parametro para ser usado no orderBy não funciona.

        if ($parameters['pOrdem'] == "numeroNota") {
            $report->Execute($module, 'repNotaFiscalTodas3', $parameters);
        } else if ($parameters['pOrdem'] == "valor") {
            $report->Execute($module, 'repNotaFiscalTodas2', $parameters);
        } else {
            $report->Execute($module, 'repNotaFiscalTodas', $parameters); // data de emissao
        }
        //($parameters['pOrdem'] == "data") ? $report->Execute($module, 'repNotaFiscalTodas', $parameters) : $report->Execute($module, 'repNotaFiscalTodas2', $parameters);
        
    }
}
?>

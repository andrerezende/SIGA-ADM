<?php
// 24/05/11 Daniel Bonfim
class frmVidaUtilNew extends MFormAJax {

	/**
	 * Business utilizado
	 * @var BusinessAdmVidaUtil
	 */
	private $vidautil;

	function __construct() {
		global $MIOLO, $module;

		parent::__construct();
		$this->SetClose($MIOLO->GetActionURL('adm', 'main:vidautil:find'));
		$this->SetTitle("Novo Vida Útil");
		$this->SetIcon($MIOLO->GetUi()->GetImage('adm', 'default_mini.png'));
		$this->defaultButton = false;
		$this->EventHandler();
	}

	function CreateFields() {
		global $MIOLO, $module, $page, $manager;


		$fields = array(
			new MTextField('tfIdVidaUtil', '', 'Conta Contábil', 20),
			new MTextField('tfDescricao', '', 'Descrição', 70),
			new MTextField('tfAnosVidaUtil', '', 'Vida Útil (Anos)', 10),
			new MTextField('tfValorResidual', '', 'Valor residual (%)', 10)
		);


		$this->SetFields($fields);

		// Atributos dos campos
		//$this->tfValor->addAttribute('maxlength',10);
		//$this->tfValor->addAttribute('onKeyUp','makeMask(this, \'##.#\');');
		//$this->tfObs->addAttribute('onBlur','makeMask(this, \'##.###.###/####-##\');');

		$go = $this->manager->getActionURL('adm', 'vidautil:find');

		$buttons = array(
			new MButton('btnRetornar', 'Retornar', $go),
			new MButton('btnSalvar', 'Salvar')
		);
		$this->SetButtons($buttons);
	}

	function btnSalvar_click() {
		global $MIOLO, $module, $page, $context, $self, $action, $perms, $state;

		$this->vidautil = $MIOLO->getBusiness($module, 'vidautil');

		$this->vidautil->idvidautil = $this->GetFieldValue('tfIdVidaUtil');
		$this->vidautil->descricao = trim(strtoupper($this->GetFieldValue('tfDescricao'))); // sempre salve com trim e strtoupper esse tipo de dado
		$this->vidautil->anosvidautil = $this->GetFieldValue('tfAnosVidaUtil');
		$this->vidautil->valorresidual = $this->GetFieldValue('tfValorResidual');

		$go = $this->manager->getActionURL('adm', 'vidautil:find');

		try {
			$this->vidautil->save();
			//$this->AddInfo("Registro adicionado com sucesso");
			//$theme->clearContent();
			$MIOLO->information("Registro adicionado com sucesso.", $go);
		} catch (Exception $e) {
			$this->AddInfo("Falha ao adicionar registro.");
		}
	}

	/*
	function btnImprimir_click() {
		global $MIOLO, $module, $item;
		$report = new MJasperReport('sigaept');
		$parameters['pIdNotaFiscal'] = $item;
		$parameters['pURL'] = $MIOLO->GetConf('home.url');
		$parameters['pIdUsuario'] = $MIOLO->login->idkey;
		//var_dump($parameters);exit;
		// o problema é no relatorio. REFAÇA-O
		$report->Execute($module, 'NotaFiscal', $parameters);
	}*/
}

?>

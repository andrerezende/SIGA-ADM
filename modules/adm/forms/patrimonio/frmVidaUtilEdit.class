<?php
// 24/05/11 Daniel Bonfim
class frmVidaUtilEdit extends MFormAJax {

	/**
	 * Business utilizado
	 * @var BusinessAdmVidaUtil
	 */
	private $objVidaUtil;
	private $vidautil; // business

	function __construct($idVidaUtil = null) {
		global $MIOLO, $module;

		$this->vidautil = $MIOLO->GetBusiness($module, 'vidautil');

		if ($idVidaUtil != null) {
			$this->objVidaUtil = $this->vidautil->getById($idVidaUtil);
		} else {
			$this->Error("Id nula");
		}

		parent::__construct();
		$this->SetClose($MIOLO->GetActionURL('adm', 'main:vidautil:find'));
		$this->SetTitle("Editar Vida Útil");
		$this->SetIcon($MIOLO->GetUi()->GetImage('adm', 'default_mini.png'));
		$this->defaultButton = false;
		$this->EventHandler();
	}

	function CreateFields() {
		global $MIOLO, $module, $page, $manager;

		$fields = array(
			new MTextlabel('hfIdVidaUtil', $this->objVidaUtil->idvidautil, 'Conta Contábil', 20),
			new MTextField('tfDescricao', $this->objVidaUtil->descricao, 'Descrição', 70),
			new MTextField('tfAnosVidaUtil', $this->objVidaUtil->anosvidautil, 'Anos de vida útil', 10),
			new MTextField('tfValorResidual', $this->objVidaUtil->valorresidual, 'Valor residual', 10)
		);
		$this->SetFields($fields);

		$go = $this->manager->getActionURL('adm', 'vidautil:find');

		$buttons = array(
			new MButton('btnRetornar', 'Retornar', $go),
			new MButton('btnSalvar', 'Salvar'),
			new MButton('btnExcluir', 'Excluir')
		);
		$this->SetButtons($buttons);
	}

	function btnSalvar_click() {
		global $MIOLO, $module, $item;

		$this->objVidaUtil->descricao = trim(strtoupper($this->GetFieldValue('tfDescricao')));
		$this->objVidaUtil->anosvidautil = $this->GetFieldValue('tfAnosVidaUtil');
		$this->objVidaUtil->valorresidual = $this->GetFieldValue('tfValorResidual');

		try {
			$this->objVidaUtil->update();
			$this->AddInfo("Registro atualizado com sucesso.");
		} catch (Exception $e) {
			$this->AddInfo("Falha ao atualizar registro.");
		}
	}

	function btnExcluir_click() {
		global $MIOLO, $module, $item, $theme;

		$go = $this->manager->getActionURL($module, 'main:vidautil:find');

		try {
			$this->objVidaUtil->delete();
			//$this->AddInfo("Registro excluído com sucesso.");
			$theme->clearContent();
			$MIOLO->information("Registro excluído com sucesso.", $go);
		} catch (Exception $e) {
			$this->AddInfo("Falha ao excluir registro.");
		}
	}

}
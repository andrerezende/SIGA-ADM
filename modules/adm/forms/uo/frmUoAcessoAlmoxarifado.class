<?
class frmUoAcessoAlmoxarifado extends Form
{
    protected $objUoAlmoxarifado;

    function __construct($objUoAlmoxarifado)
    {        
        $this->objUoAlmoxarifado = $objUoAlmoxarifado;
        $this->Form('Novo Acesso a Almoxarifado');
        $this->EventHandler();
    }

    function CreateFields()
    {
        $fields = array(
            new MSelection('idUoExecutante','','Almoxarifado',$this->objUoAlmoxarifado->listByTipoReq2(8)->result)
        );
		
        $this->SetFields($fields);
		
		$buttons = array(
        	new FormButton('btnPost', 'Gravar'),
            );
		$this->SetButtons($buttons);
    }

    function btnPost_click()
    {
        $data = $this->getData();
        try
        {
            $acesso = $this->objUoAlmoxarifado->getAcessoAlmoxarifado('new');
            $acesso->idUoExecutante = $data->idUoExecutante;
            $acesso->save();
            $go = $this->manager->GetActionURL('adm','main:uo',$this->objUoAlmoxarifado->idUo, array('form'=>'acessoalmox'));
			if ($update)
			{
	            $this->manager->Information('Acesso atualizado com sucesso.', $go );
			}
			else
			{
	            $this->manager->Information('Acesso inserido com sucesso.', $go );
			}
        }
        catch ( Exception $e )
        {
            $this->AddError($e->getMessage());
        }
    }

	function btnDel_click()
	{
		$action_sim = $this->manager->GetActionURL('adm','main:uo',$this->objUoAlmoxarifado->idUo,array('form'=>'acessoalmox','id'=>$this->getFormValue('id'),'conf'=>'sim','event'=>'btnDel:click'));
		$action_nao = $this->manager->GetActionURL('adm','main:uo',$this->objUoAlmoxarifado->idUo,array('form'=>'acessoalmox'));

		$conf = $this->GetFormValue('conf');

		if ($conf == 'sim')
		{
            try 
            {
    			$this->objUoAlmoxarifado->deleteAcessoAlmoxarifado($this->getFormValue('id'));
				$this->manager->Information('Acesso excluÃ­do com sucesso!',$this->manager->GetActionURL('adm','main:uo',$this->objUoAlmoxarifado->idUo,array('form'=>'acessoalmox')));
			}
            catch ( Exception $e )
			{
				$this->manager->Error($e->getMessage());
			}
					
	   }
	   else
	   {
           $acesso = $this->objUoAlmoxarifado->getAcessoAlmoxarifado($this->getFormValue('id'));
		   $this->manager->Question("Tem certeza que deseja excluir o acesso para ".$acesso->uoexecutante->nome."?",$action_sim,$action_nao);
		}
	}

 }
?>

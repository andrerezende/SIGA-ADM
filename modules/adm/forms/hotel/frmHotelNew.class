<?
MIOLO::Import('modules::adm::forms::hotel::frmHotelPai');

class frmHotelNew extends frmHotelPai
{
	function __construct()
	{
		$this->Form('Incluir Novo Hotel');
		$this->EventHandler();
	}

	function CreateFields()
	{
		$this->CommonFields();

		$buttons = array(
			new FormButton("btnNew","Cadastrar Hotel")
		);
		$this->SetButtons($buttons);
	}

	function btnNew_click()
	{
		$data = $this->GetData();
		$hotel = $this->manager->GetBusiness('adm','hotel');
		$hotel->SetData($data);
		
		$hotel->nome = strtoupper($hotel->nome);
		$hotel->valorDiaria = str_replace(',', '.', $hotel->valorDiaria);
		
		if(strlen(trim($hotel->nome)) < 4)
		{
			$this->AddError('Insira um nome válido para o Hotel.');
		}
		elseif(trim($hotel->valorDiaria) == '')
		{
			$this->AddError('Informe o valor da diária.');
		}
		elseif(!is_numeric($hotel->valorDiaria))
		{
			$this->AddError('Informe um valor correto para a diária.');
		}
		elseif($hotel->valorDiaria < 0)
		{
			$this->AddError('O valor da diária não pode ser negativo.');
		}
		elseif($hotel->ativo == '')
		{
			$this->AddError('Informe se o Hotel está ativo ou não no sistema.');
		}
		else
		{
			try
			{
				$hotel->save();
				$hotel->Log(OP_INS,"Novo hotel criado");
				$go = $this->manager->GetActionURL('adm','main:hotel:find',$hotel->idHotel);
				$this->manager->Information('Hotel incluído com sucesso.',$go);
			}
			catch (Exception $e)
			{
				$this->addError($e->getMessage());
			}
		}
	}
}
?>

<?
MIOLO::Import('modules::adm::forms::hotel::frmHotelPai');

class frmHotelEditar extends frmHotelPai
{

	protected $objHotel;

	function __construct($objHotel)
	{
		$this->objHotel = $objHotel;
		$this->Form('Dados do Hotel');
		$this->EventHandler();
	}

	function CreateFields()
	{
		global $MIOLO;

		$this->CommonFields();

		$buttons = array(
		      new FormButton("btnSalvar","Salvar")
		);
		$this->SetButtons($buttons);

		$this->SetData();
	}

	public function btnSalvar_click()
	{
		$this->objHotel->SetData($this->GetData());

		$this->objHotel->valorDiaria = str_replace(',', '.', $this->objHotel->valorDiaria);
		$this->objHotel->nome = strtoupper($this->objHotel->nome);

		if(trim(Form::GetFormValue('nome')) == '')
		{
			$this->AddError('Informe o nome do Hotel.');
		}
		elseif(!is_numeric(Form::GetFormValue('valorDiaria')))
		{
			$this->AddError('Informe um valor correto para a diária.');
		}
		elseif( Form::GetFormValue('valorDiaria') < 0 )
		{
			$this->AddError('O valor da diária não pode ser negativo.');
		}
		else
		{
			try
			{
				$this->objHotel->save();
				$this->objHotel->Log(OP_UPD,"Dados de hotel modificados");
				$go = $this->manager->GetActionURL('adm','main:hotel:find');
				$this->manager->Information('Dados do Hotel alterado com sucesso.',$go);
			}
			catch (Exception $e)
			{
				$this->addError($e->getMessage());
			}
		}
	}
 }
?>

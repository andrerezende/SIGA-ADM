<?php
global $MIOLO;
$MIOLO->Uses('controls/linkfornecedor.class', 'adm');

/**
 * frmFornecedorFind
 *
 * @access public
 */
class frmFornecedorFind extends Form {

/**
 * __construct
 *
 * @global MIOLO $MIOLO
 * @global string $module
 */
	public function __construct() {
		global $MIOLO, $module;

		$this->Form('Pesquisar Fornecedores');
		$this->SetClose($MIOLO->GetActionURL($module, 'main:mantutencao'));
		$this->EventHandler();
	}

/**
 * CreateFields
 *
 * @global MIOLO $MIOLO
 */
	public function CreateFields() {
		global $MIOLO;

		$busca = new MThemeBox('&nbsp;&nbsp;Buscar', array(
			new MLabel('Nome ou CNPJ:'),
			new MTextField('fornecedor', Form::getFormValue('fornecedor'), '', 40),
			new MButton('btnPost', 'Buscar'),
		));

		$ui = $MIOLO->GetUI();
		$grid = $ui->GetGrid('adm', 'gridFornecedor', Form::getFormValue('fornecedor'));
		$grid->SetTitle('Fornecedores');

		$lnkNew = new Linkfornecedor('lnkNew', FALSE);
		$lnkNew->setNew();

		$findButton = new ButtonFind('');
		$findButton->SetName('btnFind');

		$fields = array(
			array(
				$busca,
				$lnkNew,
			),
			$grid,
		);
		$this->SetFields($fields);
		$this->defaultButton = false;
	}

/**
 * btnDel_click
 *
 * @global string $module
 * @global MIOLO $MIOLO
 * @global string $self
 * @global int $item
 */
	public function btnDel_click() {
		global $MIOLO, $module, $self, $item;

		$objFornecedor = $MIOLO->GetBusiness($module, 'fornecedor', $item);

		$action_sim = $this->manager->GetActionURL($module, $self, $item, array('conf' => 'sim', 'event' => 'btnDel:click'));
		$action_nao = $this->manager->GetActionURL($module, $self);

		$conf = $this->GetFormValue('conf');

		if ($conf == 'sim') {
			try {
				$objFornecedor->delete();
				$this->manager->Information('Fornecedor excluído com sucesso!', $this->manager->GetActionURL($module, $self));
			} catch (Exception $e) {
				$this->manager->Information('O fornecedor não pode ser excluído', $this->manager->GetActionURL($module, $self));
			}
		} else {
			$this->manager->Question("Tem certeza que deseja excluir o fornecedor '$objFornecedor->nome' ?", $action_sim, $action_nao);
		}
	}

}
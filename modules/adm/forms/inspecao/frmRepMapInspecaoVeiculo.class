<?php

class frmRepMapInspecaoVeiculo extends Form {

    public function __construct() {

        parent::__construct('Mapa de Inspeção de Veículo');
        $this->EventHandler();
        $this->defaultButton = false;
    }

   public function CreateFields() {
        global $MIOLO, $module, $action, $item, $theme;


        $fields = array(
            new HiddenField('idVeiculo', ''),
            new MLookupFieldValue('lkpVeiculo', '', 'Veículo', 50),
            new HiddenField('idMotorista', ''),
            new MLookupFieldValue('lkpMotorista', '', 'Motorista', 50),
            new MCalendarField('datainicio', '', 'Data Início', 27),
            new MCalendarField('datafim', '', 'Data Fim', 27)
        );
        
        

        $this->SetFields($fields);
        
        $this->SetFieldAttr('lkpVeiculo', 'module', 'adm');
	$this->SetFieldAttr('lkpVeiculo', 'item', 'veiculouo');
	$this->SetFieldAttr('lkpVeiculo', 'event', 'filler');
        $this->SetFieldAttr('lkpVeiculo','related','idVeiculo,lkpVeiculo');
        
        $this->SetFieldAttr('lkpMotorista', 'module', 'adm');
	$this->SetFieldAttr('lkpMotorista', 'item', 'MotoristaUo');
	$this->SetFieldAttr('lkpMotorista', 'event', 'filler');
	$this->SetFieldAttr('lkpMotorista', 'related', 'idMotorista,lkpMotorista');


        $buttons = array(
            new MButton('btnPost', 'Gerar Relatório'),
        );
        $this->SetButtons($buttons);
    }

    public function btnPost_click() {
        global $MIOLO, $module, $item;

        $report = new MJasperReport('sigaept');
        $parameters['SUBREPORT_DIR'] = $MIOLO->GetConf('home.modules');
        $parameters['pURL'] = $MIOLO->GetConf('home.url');
        $idVeiculo = $this->GetFormValue('idVeiculo');
        $idMotorista = $this->GetFormValue('idMotorista');
        $datainicio = $this->GetFormValue('datainicio');
        $datafim = $this->GetFormValue('datafim');

        $MIOLO->page->AddJsCode('window.open("http://'.$_SERVER['HTTP_HOST']
        . '/relatorios2/repMapInspecaoVeiculo.php?idVeiculo=' . $idVeiculo . '&idMotorista=' . $idMotorista . '&datainicio=' . $datainicio . '&datafim=' . $datafim . '");');


	}
 
}
?>
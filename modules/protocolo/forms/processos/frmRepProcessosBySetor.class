<?php
// 11/10/2011 Daniel Bonfim
class frmRepProcessosBySetor extends MForm {
    
        private $setor;
    
	public function __construct() {
                global $MIOLO;
                $this->setor = $MIOLO->getBusiness('protocolo','setor');
		parent::__construct('Relatório de Processos de um Setor');
		$this->EventHandler();
		$this->defaultButton = false;
	}

	public function CreateFields() {
		global $MIOLO, $module, $action, $item, $theme;

        $fields = array(
                        new MSelection('pSetor', '','Setor desejado',$this->setor->selAll()),                       
			//new MLookupTextField('setor','','Setor',20),
			//new MHiddenField('idSetor'),
		);
        $this->SetFields($fields);

        //$this->SetFieldAttr('setor','module','common');
        //$this->SetFieldAttr('setor','item','setor');
        //$this->SetFieldAttr('setor','related','idSetor,setor');

        $buttons = array(
			new MButton('btnPost', 'Gerar Relatório'),
		);
		$this->SetButtons($buttons);
                
	}

	public function btnPost_click() {
            global $MIOLO, $module, $item;
            $setor = $this->GetFormValue('pSetor');
            //$idSetor = $this->GetFormValue('idSetor');

            if (empty($setor)) {
                    $this->addError("Selecione o Setor.");
                    return false;
            } else {                  
                //header("Location: http://".$_SERVER['HTTP_HOST']."/relatorios2/repProcessosBySetor.php?setor=$setor");
                $MIOLO->page->AddJsCode('window.open("http://'.$_SERVER['HTTP_HOST']
        . '/relatorios2/repProcessosBySetor.php?setor=' . $setor . '");');
            }
                
  	}
}
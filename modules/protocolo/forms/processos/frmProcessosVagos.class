<?
MIOLO::Import('modules::protocolo::controls::linkprocesso');
class frmProcessosVagos extends MForm
{
    var $processo;
    var $controle;
    var $ui; 
    function __construct()
    {
//      construct
        global $MIOLO;
    	$this->processo = $MIOLO->getBusiness('protocolo','processo');
        $this->controle = $MIOLO->getBusiness('protocolo','controleprotocolo');
   		$this->ui = $MIOLO->GetUI();
        parent::__construct('Listar Processos Vagos');
        $this->SetClose($this->manager->GetActionURL('protocolo','main'));
		$this->eventHandler();		
    }

    public function CreateFields()
    {
        //Instituição
        global $MIOLO;
        $msg_tst = $MIOLO->login->idkey;     
        $objProc = $this->manager->GetBusiness('protocolo','processo');
        $uasg = $objProc->getUASG($msg_tst);
        $value = $uasg->fields('uasg');
        $instituicao = $value; 

//      ano
        
        $ano = array('last'=>date('Y')-1,'this'=>date('Y'));
        $opt1 = new MOption( 'opt1', $ano['last'],$ano['last'].'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', false, 'id1' );
        $opt2 = new MOption( 'opt2', $ano['this'],$ano['this'].'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', false, 'id2' ); 
        $groupAno = new MRadioButtonGroup('anoCorrente','Ano do processo',array($opt1,$opt2),$ano['this'],'','horizontal','css'); 
        $groupAno->addAttribute('style','padding:10px');
//      fields
    	$fields = Array (
            $groupAno,
		);
		$this->SetFields($fields);
//      buttons
		$buttons = Array(
			new MButton('btnConsulta', 'Listar'),
						);
	    $this->SetButtons($buttons);
    }

    public function btnConsulta_click()
    {	
	 global $MIOLO;
//      data
       
        $data = $this->getData(); 
//      processos
//$processos = $this->processo->getProcessosVagos($data->anoCorrente);
        $msg_tst = $MIOLO->login->idkey;
         $objProc = $this->manager->GetBusiness('protocolo','processo');
        $uasg = $objProc->getUASG($msg_tst);
        $value = $uasg->fields('uasg');
        $instituicao = $value; 
        
        $processos = $this->processo->getProcessosVagos($data->anoCorrente,$instituicao);
        
//      grid
	    $this->AddField($this->ui->GetGrid("protocolo",'gridProcessosVagos', $processos));    
    }

}

?>

<?
MIOLO::Import('modules::protocolo::controls::linkprocesso');
class frmProcessosFindAdvanced extends MForm
{
    protected $processo;
    protected $setoracesso;
    protected $setor;
    protected $perms;
	protected $tipobox;
    function __construct()
    {
        global $MIOLO;
        $this->processo = $MIOLO->getBusiness('protocolo','processo');
        $this->setoracesso = $MIOLO->getBusiness('protocolo','setoracesso');
        $this->setor = $MIOLO->getBusiness('protocolo','setor');
        $this->perms  = $MIOLO->getPerms();
        parent::__construct('Pesquisa Avançada');
        $this->SetClose($this->manager->GetActionURL('protocolo','main'));
        $this->eventHandler();
    }
    function CreateFields()
    {
        global $MIOLO;
        $grid = $this->manager->GetUI()->GetGrid('protocolo','gridBuscaAvancada');
		$grid->setTitle('Resultado da busca');
        //TIPOS DE PROCESSO

		$lista = Form::GetFormValue('lista');
        $busca1 = Form::GetFormValue('numero');
        
        $titulo = Form::GetFormValue('titulo');
        $assunto = Form::GetFormValue('assunto');
        $solicitante = Form::GetFormValue('solicitante');
        $autor = Form::GetFormValue('autor');
        $instituicao = Form::GetFormValue('instituicao');
        $dataInicio = Form::GetFormValue('dataInicio');
        $dataFim = Form::GetFormValue('dataFim');
        $setorAtual = Form::GetFormValue('setorAtual');
        $setorOrigem = Form::GetFormValue('setorOrigem');
        $setorParticipante = Form::GetFormValue('setorParticipante');
        $cxArquivo = Form::GetFormValue('cxArquivo');
		$tipo2 = Form::GetFormValue('tipo');
		if ($tipo2 == 'Processo') $opcao1 = true;
		if ($tipo2 == 'Protocolado') $opcao2 = true;

		$opTipo = array('P'=>'Processo','A'=>'Protocolado');
        $opt1 = new MOption( 'opt1', $opTipo['P'],$opTipo['P'].'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', $opcao1, 'id1' );
        $opt2 = new MOption( 'opt2', $opTipo['A'],$opTipo['A'].'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', $opcao2, 'id2' );
        $tipo = new MRadioButtonGroup('tipo', '',array($opt1,$opt2), 'opt1','','horizontal','none');
        $tipo->addAttribute('style','padding:10px');

		$formBusca = new MThemeBox('&nbsp;&nbsp;Buscar processos por:',
                                    array( new MTextLabel('','Número'),new MTextField('numero',$busca1,'numero',20),new MTextLabel('','Tipo'),$tipo,new MTextLabel('','Título'),new MTextField('titulo',$titulo,'',50),new MTextLabel('','Assunto'),
                                           new MTextField('assunto',$assunto,'',50),new MTextLabel('','Sólicitante'), new MTextField('solicitante',$solicitante,'',40),new MTextLabel('','Autor (Deu Entrada)'), new MTextField('autor',$autor,'',40),
                                           new MTextLabel('','Instituição (UP)'), new MTextField('instituicao',$instituicao,'',20),new MTextLabel('','Período'),new MLabel('Data Início:'),new MCalendarField('dataInicio',$dataInicio,'',10),
                                           new MLabel('&nbsp;&nbsp;&nbsp;Data Fim:'),new MCalendarField('dataFim',$dataFim,'',10),new MTextLabel('','Setor Atual'), new MTextField('setorAtual',$setorAtual,'',30),new MTextLabel('','Setor de Origem'),
                                           new MTextField('setorOrigem',$setorOrigem,'',30),new MTextLabel('','Setor Participante'), new MTextField('setorParticipante',$setorParticipante,'',30),new MTextLabel('','Caixa Arquivo'),
                                           new MTextField('cxArquivo',$cxArquivo,'',20),new MTextLabel('', ''),new MButton('btnBuscar','Buscar') )
                                  );
        $formBusca->width = '66%';
        $formBusca->float = 'left';
        $formBusca->padding = '6px';
        $formBusca->height = '650px';
        $novo = new LinkProcesso('lnkNovo',FALSE);
        $novo->setNew();
        $linkNovo = array($novo,new MSpacer('5px'));
        $vago = new LinkProcesso('lnkVago',FALSE);
        $vago->setNewVago();
        $linkVago = ($this->perms->checkAccess('PROT_ADMIN', A_ACCESS)) ? array($vago,new MSpacer('5px')) : null;
        $consulta = new LinkProcesso('lnkConsulta',FALSE);
        $consulta->setConsulta();
        $linkConsulta = array($consulta,new MSpacer('5px'));
        $documentacao = new LinkProcesso('lnkDocumentacao',FALSE);
        $documentacao->setDocumentacao();
        $linkDocumentacao = array($documentacao,new MSpacer('5px'));
        // 04-11-2011 - Daniel Bonfim
                $processosPendentes = new LinkProcesso('lnkProcessosPendentes',FALSE);
		$processosPendentes->setProcessosPendentes();
		$linkProcessosPendentes = array($processosPendentes,new MSpacer('5px'));
                
        // 04-11-2011 - Daniel Bonfim
                $usuarios = new LinkProcesso('lnkUsuarios',FALSE);
		$usuarios->setUsuarios();
		$linkUsuarios = array($usuarios,new MSpacer('5px'));
                
        // 04-11-2011 - Daniel Bonfim
                $usuariosPorSetor = new LinkProcesso('lnkUsuariosPorSetor',FALSE);
		$usuariosPorSetor->setUsuariosPorSetor();
		$linkUsuariosPorSetor = array($usuariosPorSetor,new MSpacer('5px'));
                
        // 04-11-2011 - Daniel Bonfim
                $processosMaxNumanda = new LinkProcesso('lnkProcessosMaxNumanda',FALSE);
		$processosMaxNumanda->setProcessosMaxNumanda();
		$linkProcessosMaxNumanda = array($processosMaxNumanda,new MSpacer('5px'));
                
        $formLink = new MThemeBox('&nbsp;&nbsp;Outras opções', array($linkNovo,$linkVago,$linkDocumentacao,$linkProcessosPendentes,
            $linkProcessosMaxNumanda,$linkUsuarios,$linkUsuariosPorSetor));
        $formLink->width = '30%';
        $formLink->float = 'right';
        $formLink->padding = '6px';
        $formLink->height = '190px';
        $opcoes = array( "entrada"=>"entrada","saida"=>"saída");
        $lista = Form::GetFormValue('lista');
        //if (!$listaPor = Form::GetFormValue('listaPor')) $listaPor = $this->processo->getSetorUsuario();
        if (!in_array($this->processo->getSetorUsuario(),$this->setor->selAll()))
        {
            $this->addError('Você está logado em um setor inválido. Por favor, procure o CGCO.');
        }
        $setores = ($this->perms->checkAccess('PROT_ADMIN', A_ACCESS)) ? $this->setor->selAll() : $this->setoracesso->selSetoresAcesso($this->processo->getSetorUsuario());
        $formListar = new MThemeBox('&nbsp;&nbsp;Listar processos', array(new MText('','aguardando'),new MSelection('lista',$lista,'',$opcoes),new MText('','no setor'),new MSelection('listaPor',$listaPor,'',$setores),new MButton('btnLista','Listar')));
        $formListar->float = 'left';
        $formListar->padding = '6px';
        $formListar->height = '50px';
        $formListar->width = '66%';                                                                                         

		$fields = array(
            new Spacer('5px'),
            $formBusca,
            $formLink,
            $formListar,
            $grid,
        );
        $this->SetFields($fields);
        $this->defaultButton = false;
    }

	/*public function btnBuscar_click(){

		//$this->tipobox1 = $this->tipobox1;
		//$this->tipobox2 = $this->tipobox2;

		$MIOLO->GetActionURL('protocolo','main:processos:findAdvanced');
	}*/

 }
?>
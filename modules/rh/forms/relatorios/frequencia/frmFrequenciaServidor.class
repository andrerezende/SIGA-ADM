<?
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */

class frmFrequenciaServidor extends MForm
{                                                    
    function __construct()
    {
        parent::__construct('Relatório de Freqüência do Servidor por ano');
        $this->SetClose($this->manager->GetActionURL('rh','main:relatorio:frequencia'));
        $this->EventHandler();
    }

    function CreateFields()
    {
        $fields = array(
            new MTextField('ano','','Ano','6','use 4 dígitos'),
            new MTextField('idVinculo','','Matrícula'),
        );
        $this->setFields($fields);
        $this->SetFieldAttr('ano','maxLength',4);
        //$this->idVinculo->addAttribute('maxLength','4');
        $buttons = array(
            new MButton('btnReport','Gerar Relatório','PDF'),
       //     new MButton('btnGerarCSV','Gerar Planilha(falta acabar)')
        );
        $this->setButtons($buttons);                               
    }
    
   /* function btnGerarCSV_click()
	{
		$data = $this->getData();
		$vinculo = $this->manager->getBusiness('rh','vinculo',$data->idVinculo);
		
		if ($data->idVinculo == NULL)
            $erro[] = "Informe a matrícula";
        if (!$vinculo->isPersistent())
            $erro[] = "Matrícula inválida";
        if ($data->ano == NULL)
            $erro[] = "Informe o ano";
        if ($data->ano > date('Y'))
            $erro[] = "O ano deve ser anterior ao ano corrente.";
        if ( count($erro) > 0 )
        {
            foreach ( $erro as $e ) $this->addError($e);
        }
        else
        {
        	$data->vinculo = $vinculo;
        	$consulta = $func->listAniversariantes($selMes,$selCtg);        	
        	
        	if ($selCtg==2) //APOSENTADO
        	{
        		$resultAux[] = array('VÍNCULO','DATA NASCIMENTO','NOME','ENDEREÇO','MUNICIPIO','BAIRRO','CEP');
        		foreach ($consulta->result as $result)		  
		    	{
		    		$resultAux[] = array($result[1],$result[2],$result[3],$result[5],$result[6],$result[7],$result[8]);		
		    	}
        	}
        	else 
        	{
        		$resultAux[] = array('VÍNCULO','DATA NASCIMENTO','NOME','SETOR');
        		foreach ($consulta->result as $result)		  
		    	{
		    		$resultAux[] = array($result[1],$result[2],$result[3],$result[4]);		
		    	}
        	}   
				    
		    $consulta->result = $resultAux;
			$consulta->getCSV("frequenciaServidorAno.$selMes");
        }
	}*/
    
    function btnReport_click()
    {
        $data = $this->getData();
        $vinculo = $this->manager->getBusiness('rh','vinculo',$data->idVinculo);
        if ($data->idVinculo == NULL)
            $erro[] = "Informe a matrícula";
        if (!$vinculo->isPersistent())
            $erro[] = "Matrícula inválida";
        if ($data->ano == NULL)
            $erro[] = "Informe o ano";
        if ($data->ano > date('Y'))
            $erro[] = "O ano deve ser anterior ao ano corrente.";
        if ( count($erro) > 0 )
        {
            foreach ( $erro as $e ) $this->addError($e);
        }
        else
        {
            $ui = $this->manager->getUi();
            $data->vinculo = $vinculo;
            $report = $ui->getReport('rh','repFrequenciaServidor',$data);
            $report->generate();
        }
    }
}
?>
